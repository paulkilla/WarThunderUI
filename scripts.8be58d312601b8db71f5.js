!function(e){"use strict";var t=function(e,n,i){return 1===arguments.length?t.get(e):t.set(e,n,i)};t._document=document,t._navigator=navigator,t.defaults={path:"/"},t.get=function(e){return t._cachedDocumentCookie!==t._document.cookie&&t._renewCache(),t._cache[e]},t.set=function(n,i,r){return(r=t._getExtendedOptions(r)).expires=t._getExpiresDate(i===e?-1:r.expires),t._document.cookie=t._generateCookieString(n,i,r),t},t.expire=function(n,i){return t.set(n,e,i)},t._getExtendedOptions=function(n){return{path:n&&n.path||t.defaults.path,domain:n&&n.domain||t.defaults.domain,expires:n&&n.expires||t.defaults.expires,secure:n&&n.secure!==e?n.secure:t.defaults.secure}},t._isValidDate=function(e){return"[object Date]"===Object.prototype.toString.call(e)&&!isNaN(e.getTime())},t._getExpiresDate=function(e,n){switch(n=n||new Date,typeof e){case"number":e=new Date(n.getTime()+1e3*e);break;case"string":e=new Date(e)}if(e&&!t._isValidDate(e))throw new Error("`expires` parameter cannot be converted to a valid Date instance");return e},t._generateCookieString=function(e,t,n){var i=(e=encodeURIComponent(e))+"="+(t=(t+"").replace(/[^!#$&-+\--:<-\[\]-~]/g,encodeURIComponent));return i+=(n=n||{}).path?";path="+n.path:"",i+=n.domain?";domain="+n.domain:"",(i+=n.expires?";expires="+n.expires.toGMTString():"")+(n.secure?";secure":"")},t._getCookieObjectFromString=function(n){for(var i={},r=n?n.split("; "):[],a=0;a<r.length;a++){var s=t._getKeyValuePairFromCookieString(r[a]);i[s.key]===e&&(i[s.key]=s.value)}return i},t._getKeyValuePairFromCookieString=function(e){var t=e.indexOf("=");return t=t<0?e.length:t,{key:decodeURIComponent(e.substr(0,t)),value:decodeURIComponent(e.substr(t+1))}},t._renewCache=function(){t._cache=t._getCookieObjectFromString(t._document.cookie),t._cachedDocumentCookie=t._document.cookie},t._areEnabled=function(){return t._navigator.cookieEnabled||"1"===t.set("cookies.js",1).get("cookies.js")},t.enabled=t._areEnabled(),"function"==typeof define&&define.amd?define(function(){return t}):"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=t),exports.Cookies=t):window.Cookies=t}();var Sylvester={version:"0.1.3",precision:1e-6};function Vector(){}function Matrix(){}function Line(){}function Plane(){}Vector.prototype={e:function(e){return e<1||e>this.elements.length?null:this.elements[e-1]},at:function(e){return e<0||e>=this.elements.length?null:this.elements[e]},dimensions:function(){return this.elements.length},modulus:function(){return Math.sqrt(this.dot(this))},eql:function(e){var t=this.elements.length,n=e.elements||e;if(t!=n.length)return!1;do{if(Math.abs(this.elements[t-1]-n[t-1])>Sylvester.precision)return!1}while(--t);return!0},dup:function(){return Vector.create(this.elements)},map:function(e){var t=[];return this.each(function(n,i){t.push(e(n,i))}),Vector.create(t)},each:function(e){var t,n=this.elements.length,i=n;do{e(this.elements[t=i-n],t+1)}while(--n)},toUnitVector:function(){var e=this.modulus();return 0===e?this.dup():this.map(function(t){return t/e})},angleFrom:function(e){var t=e.elements||e;if(this.elements.length!=t.length)return null;var n=0,i=0,r=0;if(this.each(function(e,a){n+=e*t[a-1],i+=e*e,r+=t[a-1]*t[a-1]}),i=Math.sqrt(i),r=Math.sqrt(r),i*r==0)return null;var a=n/(i*r);return a<-1&&(a=-1),a>1&&(a=1),Math.acos(a)},signedAngle2DFrom:function(e){var t=this.elements,n=e.elements||e;return 2!=n.length||2!=t.length?null:Math.atan2(n[0]*t[1]-n[1]*t[0],n[0]*t[0]+n[1]*t[1])},isParallelTo:function(e){var t=this.angleFrom(e);return null===t?null:t<=Sylvester.precision},isAntiparallelTo:function(e){var t=this.angleFrom(e);return null===t?null:Math.abs(t-Math.PI)<=Sylvester.precision},isPerpendicularTo:function(e){var t=this.dot(e);return null===t?null:Math.abs(t)<=Sylvester.precision},add:function(e){var t=e.elements||e;return this.elements.length!=t.length?null:this.map(function(e,n){return e+t[n-1]})},subtract:function(e){var t=e.elements||e;return this.elements.length!=t.length?null:this.map(function(e,n){return e-t[n-1]})},multiply:function(e){return this.map(function(t){return t*e})},x:function(e){return this.multiply(e)},dot:function(e){var t=e.elements||e,n=0,i=this.elements.length;if(i!=t.length)return null;do{n+=this.elements[i-1]*t[i-1]}while(--i);return n},cross:function(e){var t=e.elements||e;if(3!=this.elements.length||3!=t.length)return null;var n=this.elements;return Vector.create([n[1]*t[2]-n[2]*t[1],n[2]*t[0]-n[0]*t[2],n[0]*t[1]-n[1]*t[0]])},max:function(){var e,t=0,n=this.elements.length,i=n;do{e=i-n,Math.abs(this.elements[e])>Math.abs(t)&&(t=this.elements[e])}while(--n);return t},indexOf:function(e){var t,n=null,i=this.elements.length,r=i;do{t=r-i,null===n&&this.elements[t]==e&&(n=t+1)}while(--i);return n},toDiagonalMatrix:function(){return Matrix.Diagonal(this.elements)},round:function(){return this.map(function(e){return Math.round(e)})},snapTo:function(e){return this.map(function(t){return Math.abs(t-e)<=Sylvester.precision?e:t})},distanceFrom:function(e){if(e.anchor)return e.distanceFrom(this);var t=e.elements||e;if(t.length!=this.elements.length)return null;var n,i=0;return this.each(function(e,r){i+=(n=e-t[r-1])*n}),Math.sqrt(i)},liesOn:function(e){return e.contains(this)},liesIn:function(e){return e.contains(this)},rotate:function(e,t){var n,i,r,a,s;switch(this.elements.length){case 2:return 2!=(n=t.elements||t).length?null:(i=Matrix.Rotation(e).elements,Vector.create([n[0]+i[0][0]*(r=this.elements[0]-n[0])+i[0][1]*(a=this.elements[1]-n[1]),n[1]+i[1][0]*r+i[1][1]*a]));case 3:if(!t.direction)return null;var o=t.pointClosestTo(this).elements;return i=Matrix.Rotation(e,t.direction).elements,Vector.create([o[0]+i[0][0]*(r=this.elements[0]-o[0])+i[0][1]*(a=this.elements[1]-o[1])+i[0][2]*(s=this.elements[2]-o[2]),o[1]+i[1][0]*r+i[1][1]*a+i[1][2]*s,o[2]+i[2][0]*r+i[2][1]*a+i[2][2]*s]);default:return null}},reflectionIn:function(e){if(e.anchor){var t=this.elements.slice(),n=e.pointClosestTo(t).elements;return Vector.create([n[0]+(n[0]-t[0]),n[1]+(n[1]-t[1]),n[2]+(n[2]-(t[2]||0))])}var i=e.elements||e;return this.elements.length!=i.length?null:this.map(function(e,t){return i[t-1]+(i[t-1]-e)})},to3D:function(){var e=this.dup();switch(e.elements.length){case 3:break;case 2:e.elements.push(0);break;default:return null}return e},inspect:function(){return"["+this.elements.join(", ")+"]"},setElements:function(e){return this.elements=(e.elements||e).slice(),this}},Vector.create=function(e){return(new Vector).setElements(e)},Vector.i=Vector.create([1,0,0]),Vector.j=Vector.create([0,1,0]),Vector.k=Vector.create([0,0,1]),Vector.Random=function(e){var t=[];do{t.push(Math.random())}while(--e);return Vector.create(t)},Vector.Zero=function(e){var t=[];do{t.push(0)}while(--e);return Vector.create(t)},Matrix.prototype={e:function(e,t){return e<1||e>this.elements.length||t<1||t>this.elements[0].length?null:this.elements[e-1][t-1]},row:function(e){return e>this.elements.length?null:Vector.create(this.elements[e-1])},col:function(e){if(e>this.elements[0].length)return null;var t=[],n=this.elements.length,i=n;do{t.push(this.elements[i-n][e-1])}while(--n);return Vector.create(t)},dimensions:function(){return{rows:this.elements.length,cols:this.elements[0].length}},rows:function(){return this.elements.length},cols:function(){return this.elements[0].length},eql:function(e){var t=e.elements||e;if(void 0===t[0][0]&&(t=Matrix.create(t).elements),this.elements.length!=t.length||this.elements[0].length!=t[0].length)return!1;var n,i,r,a=this.elements.length,s=a,o=this.elements[0].length;do{n=s-a,i=o;do{if(r=o-i,Math.abs(this.elements[n][r]-t[n][r])>Sylvester.precision)return!1}while(--i)}while(--a);return!0},dup:function(){return Matrix.create(this.elements)},map:function(e){var t,n,i,r=[],a=this.elements.length,s=a,o=this.elements[0].length;do{n=o,r[t=s-a]=[];do{r[t][i=o-n]=e(this.elements[t][i],t+1,i+1)}while(--n)}while(--a);return Matrix.create(r)},isSameSizeAs:function(e){var t=e.elements||e;return void 0===t[0][0]&&(t=Matrix.create(t).elements),this.elements.length==t.length&&this.elements[0].length==t[0].length},add:function(e){var t=e.elements||e;return void 0===t[0][0]&&(t=Matrix.create(t).elements),this.isSameSizeAs(t)?this.map(function(e,n,i){return e+t[n-1][i-1]}):null},subtract:function(e){var t=e.elements||e;return void 0===t[0][0]&&(t=Matrix.create(t).elements),this.isSameSizeAs(t)?this.map(function(e,n,i){return e-t[n-1][i-1]}):null},canMultiplyFromLeft:function(e){var t=e.elements||e;return void 0===t[0][0]&&(t=Matrix.create(t).elements),this.elements[0].length==t.length},multiply:function(e){if(!e.elements)return this.map(function(t){return t*e});var t=!!e.modulus;if(void 0===(p=e.elements||e)[0][0]&&(p=Matrix.create(p).elements),!this.canMultiplyFromLeft(p))return null;var n,i,r,a,s,o,l=this.elements.length,c=l,h=p[0].length,u=this.elements[0].length,m=[];do{m[n=c-l]=[],i=h;do{r=h-i,a=0,s=u;do{a+=this.elements[n][o=u-s]*p[o][r]}while(--s);m[n][r]=a}while(--i)}while(--l);var p=Matrix.create(m);return t?p.col(1):p},x:function(e){return this.multiply(e)},minor:function(e,t,n,i){var r,a,s,o=[],l=n,c=this.elements.length,h=this.elements[0].length;do{o[r=n-l]=[],a=i;do{o[r][s=i-a]=this.elements[(e+r-1)%c][(t+s-1)%h]}while(--a)}while(--l);return Matrix.create(o)},transpose:function(){var e,t,n,i=this.elements.length,r=this.elements[0].length,a=[],s=r;do{a[e=r-s]=[],t=i;do{a[e][n=i-t]=this.elements[n][e]}while(--t)}while(--s);return Matrix.create(a)},isSquare:function(){return this.elements.length==this.elements[0].length},max:function(){var e,t,n,i=0,r=this.elements.length,a=r,s=this.elements[0].length;do{e=a-r,t=s;do{n=s-t,Math.abs(this.elements[e][n])>Math.abs(i)&&(i=this.elements[e][n])}while(--t)}while(--r);return i},indexOf:function(e){var t,n,i,r=this.elements.length,a=r,s=this.elements[0].length;do{t=a-r,n=s;do{if(this.elements[t][i=s-n]==e)return{i:t+1,j:i+1}}while(--n)}while(--r);return null},diagonal:function(){if(!this.isSquare)return null;var e,t=[],n=this.elements.length,i=n;do{t.push(this.elements[e=i-n][e])}while(--n);return Vector.create(t)},toRightTriangular:function(){var e,t,n,i,r=this.dup(),a=this.elements.length,s=a,o=this.elements[0].length;do{if(0==r.elements[t=s-a][t])for(j=t+1;j<s;j++)if(0!=r.elements[j][t]){e=[],n=o;do{e.push(r.elements[t][i=o-n]+r.elements[j][i])}while(--n);r.elements[t]=e;break}if(0!=r.elements[t][t])for(j=t+1;j<s;j++){var l=r.elements[j][t]/r.elements[t][t];e=[],n=o;do{e.push((i=o-n)<=t?0:r.elements[j][i]-r.elements[t][i]*l)}while(--n);r.elements[j]=e}}while(--a);return r},toUpperTriangular:function(){return this.toRightTriangular()},determinant:function(){if(!this.isSquare())return null;var e,t=this.toRightTriangular(),n=t.elements[0][0],i=t.elements.length-1,r=i;do{n*=t.elements[e=r-i+1][e]}while(--i);return n},det:function(){return this.determinant()},isSingular:function(){return this.isSquare()&&0===this.determinant()},trace:function(){if(!this.isSquare())return null;var e,t=this.elements[0][0],n=this.elements.length-1,i=n;do{t+=this.elements[e=i-n+1][e]}while(--n);return t},tr:function(){return this.trace()},rank:function(){var e,t,n=this.toRightTriangular(),i=0,r=this.elements.length,a=r,s=this.elements[0].length;do{e=a-r,t=s;do{if(Math.abs(n.elements[e][s-t])>Sylvester.precision){i++;break}}while(--t)}while(--r);return i},rk:function(){return this.rank()},augment:function(e){var t=e.elements||e;void 0===t[0][0]&&(t=Matrix.create(t).elements);var n,i,r,a=this.dup(),s=a.elements[0].length,o=a.elements.length,l=o,c=t[0].length;if(o!=t.length)return null;do{n=l-o,i=c;do{a.elements[n][s+(r=c-i)]=t[n][r]}while(--i)}while(--o);return a},inverse:function(){if(!this.isSquare()||this.isSingular())return null;var e,t,n,i,r,a,s,o=this.elements.length,l=o,c=this.augment(Matrix.I(o)).toRightTriangular(),h=c.elements[0].length,u=[];do{r=[],n=h,u[e=o-1]=[],a=c.elements[e][e];do{r.push(s=c.elements[e][i=h-n]/a),i>=l&&u[e].push(s)}while(--n);for(c.elements[e]=r,t=0;t<e;t++){r=[],n=h;do{r.push(c.elements[t][i=h-n]-c.elements[e][i]*c.elements[t][e])}while(--n);c.elements[t]=r}}while(--o);return Matrix.create(u)},inv:function(){return this.inverse()},round:function(){return this.map(function(e){return Math.round(e)})},snapTo:function(e){return this.map(function(t){return Math.abs(t-e)<=Sylvester.precision?e:t})},inspect:function(){var e=[],t=this.elements.length,n=t;do{e.push(Vector.create(this.elements[n-t]).inspect())}while(--t);return e.join("\n")},setElements:function(e){var t,n=e.elements||e;if(void 0!==n[0][0]){var i,r,a,s=n.length,o=s;this.elements=[];do{r=i=n[t=o-s].length,this.elements[t]=[];do{this.elements[t][a=r-i]=n[t][a]}while(--i)}while(--s);return this}var l=n.length,c=l;this.elements=[];do{this.elements.push([n[t=c-l]])}while(--l);return this}},Matrix.create=function(e){return(new Matrix).setElements(e)},Matrix.I=function(e){var t,n,i,r=[],a=e;do{r[t=a-e]=[],n=a;do{r[t][i=a-n]=t==i?1:0}while(--n)}while(--e);return Matrix.create(r)},Matrix.Diagonal=function(e){var t,n=e.length,i=n,r=Matrix.I(n);do{r.elements[t=i-n][t]=e[t]}while(--n);return r},Matrix.Rotation=function(e,t){if(!t)return Matrix.create([[Math.cos(e),-Math.sin(e)],[Math.sin(e),Math.cos(e)]]);var n=t.dup();if(3!=n.elements.length)return null;var i=n.modulus(),r=n.elements[0]/i,a=n.elements[1]/i,s=n.elements[2]/i,o=Math.sin(e),l=Math.cos(e),c=1-l;return Matrix.create([[c*r*r+l,c*r*a-o*s,c*r*s+o*a],[c*r*a+o*s,c*a*a+l,c*a*s-o*r],[c*r*s-o*a,c*a*s+o*r,c*s*s+l]])},Matrix.RotationX=function(e){var t=Math.cos(e),n=Math.sin(e);return Matrix.create([[1,0,0],[0,t,-n],[0,n,t]])},Matrix.RotationY=function(e){var t=Math.cos(e),n=Math.sin(e);return Matrix.create([[t,0,n],[0,1,0],[-n,0,t]])},Matrix.RotationZ=function(e){var t=Math.cos(e),n=Math.sin(e);return Matrix.create([[t,-n,0],[n,t,0],[0,0,1]])},Matrix.Random=function(e,t){return Matrix.Zero(e,t).map(function(){return Math.random()})},Matrix.Zero=function(e,t){var n,i,r=[],a=e;do{r[n=e-a]=[],i=t;do{r[n][t-i]=0}while(--i)}while(--a);return Matrix.create(r)},Line.prototype={eql:function(e){return this.isParallelTo(e)&&this.contains(e.anchor)},dup:function(){return Line.create(this.anchor,this.direction)},translate:function(e){var t=e.elements||e;return Line.create([this.anchor.elements[0]+t[0],this.anchor.elements[1]+t[1],this.anchor.elements[2]+(t[2]||0)],this.direction)},isParallelTo:function(e){if(e.normal)return e.isParallelTo(this);var t=this.direction.angleFrom(e.direction);return Math.abs(t)<=Sylvester.precision||Math.abs(t-Math.PI)<=Sylvester.precision},distanceFrom:function(e){if(e.normal)return e.distanceFrom(this);if(e.direction){if(this.isParallelTo(e))return this.distanceFrom(e.anchor);var t=this.direction.cross(e.direction).toUnitVector().elements,n=this.anchor.elements,i=e.anchor.elements;return Math.abs((n[0]-i[0])*t[0]+(n[1]-i[1])*t[1]+(n[2]-i[2])*t[2])}var r=e.elements||e,a=this.direction.elements,s=r[0]-(n=this.anchor.elements)[0],o=r[1]-n[1],l=(r[2]||0)-n[2],c=Math.sqrt(s*s+o*o+l*l);if(0===c)return 0;var h=(s*a[0]+o*a[1]+l*a[2])/c,u=1-h*h;return Math.abs(c*Math.sqrt(u<0?0:u))},contains:function(e){var t=this.distanceFrom(e);return null!==t&&t<=Sylvester.precision},liesIn:function(e){return e.contains(this)},intersects:function(e){return e.normal?e.intersects(this):!this.isParallelTo(e)&&this.distanceFrom(e)<=Sylvester.precision},intersectionWith:function(e){if(e.normal)return e.intersectionWith(this);if(!this.intersects(e))return null;var t=this.anchor.elements,n=this.direction.elements,i=e.anchor.elements,r=e.direction.elements,a=n[0],s=n[1],o=n[2],l=r[0],c=r[1],h=r[2],u=t[0]-i[0],m=t[1]-i[1],p=t[2]-i[2],d=l*l+c*c+h*h,g=a*l+s*c+o*h,f=((-a*u-s*m-o*p)*d/(a*a+s*s+o*o)+g*(l*u+c*m+h*p))/(d-g*g);return Vector.create([t[0]+f*a,t[1]+f*s,t[2]+f*o])},pointClosestTo:function(e){if(e.direction){if(this.intersects(e))return this.intersectionWith(e);if(this.isParallelTo(e))return null;var t=e.direction.elements,n=t[0],i=t[1],r=t[2],a=Vector.create([(u=(h=(o=this.direction.elements)[2])*n-(l=o[0])*r)*r-(m=l*i-(c=o[1])*n)*i,m*n-(p=c*r-h*i)*r,p*i-u*n]);return(s=Plane.create(e.anchor,a)).intersectionWith(this)}var s;if(this.contains(s=e.elements||e))return Vector.create(s);var o,l,c,h,u,m,p,d=this.anchor.elements,g=d[0],f=d[1],v=d[2],_=Vector.create([(c=(o=this.direction.elements)[1])*(u=(l=o[0])*(s[1]-f)-c*(s[0]-g))-(h=o[2])*(p=h*(s[0]-g)-l*((s[2]||0)-v)),h*(m=c*((s[2]||0)-v)-h*(s[1]-f))-l*u,l*p-c*m]),y=this.distanceFrom(s)/_.modulus();return Vector.create([s[0]+_.elements[0]*y,s[1]+_.elements[1]*y,(s[2]||0)+_.elements[2]*y])},rotate:function(e,t){void 0===t.direction&&(t=Line.create(t.to3D(),Vector.k));var n=Matrix.Rotation(e,t.direction).elements,i=t.pointClosestTo(this.anchor).elements,r=this.anchor.elements,a=this.direction.elements,s=i[0],o=i[1],l=i[2],c=r[0]-s,h=r[1]-o,u=r[2]-l;return Line.create([s+n[0][0]*c+n[0][1]*h+n[0][2]*u,o+n[1][0]*c+n[1][1]*h+n[1][2]*u,l+n[2][0]*c+n[2][1]*h+n[2][2]*u],[n[0][0]*a[0]+n[0][1]*a[1]+n[0][2]*a[2],n[1][0]*a[0]+n[1][1]*a[1]+n[1][2]*a[2],n[2][0]*a[0]+n[2][1]*a[1]+n[2][2]*a[2]])},reflectionIn:function(e){if(e.normal){var t=this.anchor.elements,n=this.direction.elements,i=t[0],r=t[1],a=t[2],s=n[0],o=n[1],l=n[2],c=this.anchor.reflectionIn(e).elements,h=i+s,u=r+o,m=a+l,p=e.pointClosestTo([h,u,m]).elements;return Line.create(c,[p[0]+(p[0]-h)-c[0],p[1]+(p[1]-u)-c[1],p[2]+(p[2]-m)-c[2]])}if(e.direction)return this.rotate(Math.PI,e);var d=e.elements||e;return Line.create(this.anchor.reflectionIn([d[0],d[1],d[2]||0]),this.direction)},setVectors:function(e,t){if(e=Vector.create(e),t=Vector.create(t),2==e.elements.length&&e.elements.push(0),2==t.elements.length&&t.elements.push(0),e.elements.length>3||t.elements.length>3)return null;var n=t.modulus();return 0===n?null:(this.anchor=e,this.direction=Vector.create([t.elements[0]/n,t.elements[1]/n,t.elements[2]/n]),this)}},Line.create=function(e,t){return(new Line).setVectors(e,t)},Line.X=Line.create(Vector.Zero(3),Vector.i),Line.Y=Line.create(Vector.Zero(3),Vector.j),Line.Z=Line.create(Vector.Zero(3),Vector.k),Plane.prototype={eql:function(e){return this.contains(e.anchor)&&this.isParallelTo(e)},dup:function(){return Plane.create(this.anchor,this.normal)},translate:function(e){var t=e.elements||e;return Plane.create([this.anchor.elements[0]+t[0],this.anchor.elements[1]+t[1],this.anchor.elements[2]+(t[2]||0)],this.normal)},isParallelTo:function(e){var t;return e.normal?(t=this.normal.angleFrom(e.normal),Math.abs(t)<=Sylvester.precision||Math.abs(Math.PI-t)<=Sylvester.precision):e.direction?this.normal.isPerpendicularTo(e.direction):null},isPerpendicularTo:function(e){var t=this.normal.angleFrom(e.normal);return Math.abs(Math.PI/2-t)<=Sylvester.precision},distanceFrom:function(e){if(this.intersects(e)||this.contains(e))return 0;if(e.anchor){var t=this.anchor.elements,n=e.anchor.elements,i=this.normal.elements;return Math.abs((t[0]-n[0])*i[0]+(t[1]-n[1])*i[1]+(t[2]-n[2])*i[2])}var r=e.elements||e;return t=this.anchor.elements,i=this.normal.elements,Math.abs((t[0]-r[0])*i[0]+(t[1]-r[1])*i[1]+(t[2]-(r[2]||0))*i[2])},contains:function(e){if(e.normal)return null;if(e.direction)return this.contains(e.anchor)&&this.contains(e.anchor.add(e.direction));var t=e.elements||e,n=this.anchor.elements,i=this.normal.elements;return Math.abs(i[0]*(n[0]-t[0])+i[1]*(n[1]-t[1])+i[2]*(n[2]-(t[2]||0)))<=Sylvester.precision},intersects:function(e){return void 0===e.direction&&void 0===e.normal?null:!this.isParallelTo(e)},intersectionWith:function(e){if(!this.intersects(e))return null;if(e.direction){var t=e.direction.elements,n=this.anchor.elements,i=((a=this.normal.elements)[0]*(n[0]-(s=e.anchor.elements)[0])+a[1]*(n[1]-s[1])+a[2]*(n[2]-s[2]))/(a[0]*t[0]+a[1]*t[1]+a[2]*t[2]);return Vector.create([s[0]+t[0]*i,s[1]+t[1]*i,s[2]+t[2]*i])}if(e.normal){for(var r=this.normal.cross(e.normal).toUnitVector(),a=this.normal.elements,s=this.anchor.elements,o=e.normal.elements,l=e.anchor.elements,c=Matrix.Zero(2,2),h=0;c.isSingular();)h++,c=Matrix.create([[a[h%3],a[(h+1)%3]],[o[h%3],o[(h+1)%3]]]);for(var u=c.inverse().elements,m=a[0]*s[0]+a[1]*s[1]+a[2]*s[2],p=o[0]*l[0]+o[1]*l[1]+o[2]*l[2],d=[u[0][0]*m+u[0][1]*p,u[1][0]*m+u[1][1]*p],g=[],f=1;f<=3;f++)g.push(h==f?0:d[(f+(5-h)%3)%3]);return Line.create(g,r)}},pointClosestTo:function(e){var t=e.elements||e,n=this.anchor.elements,i=this.normal.elements,r=(n[0]-t[0])*i[0]+(n[1]-t[1])*i[1]+(n[2]-(t[2]||0))*i[2];return Vector.create([t[0]+i[0]*r,t[1]+i[1]*r,(t[2]||0)+i[2]*r])},rotate:function(e,t){var n=Matrix.Rotation(e,t.direction).elements,i=t.pointClosestTo(this.anchor).elements,r=this.anchor.elements,a=this.normal.elements,s=i[0],o=i[1],l=i[2],c=r[0]-s,h=r[1]-o,u=r[2]-l;return Plane.create([s+n[0][0]*c+n[0][1]*h+n[0][2]*u,o+n[1][0]*c+n[1][1]*h+n[1][2]*u,l+n[2][0]*c+n[2][1]*h+n[2][2]*u],[n[0][0]*a[0]+n[0][1]*a[1]+n[0][2]*a[2],n[1][0]*a[0]+n[1][1]*a[1]+n[1][2]*a[2],n[2][0]*a[0]+n[2][1]*a[1]+n[2][2]*a[2]])},reflectionIn:function(e){if(e.normal){var t=this.anchor.elements,n=this.normal.elements,i=t[0],r=t[1],a=t[2],s=n[0],o=n[1],l=n[2],c=this.anchor.reflectionIn(e).elements,h=i+s,u=r+o,m=a+l,p=e.pointClosestTo([h,u,m]).elements;return Plane.create(c,[p[0]+(p[0]-h)-c[0],p[1]+(p[1]-u)-c[1],p[2]+(p[2]-m)-c[2]])}if(e.direction)return this.rotate(Math.PI,e);var d=e.elements||e;return Plane.create(this.anchor.reflectionIn([d[0],d[1],d[2]||0]),this.normal)},setVectors:function(e,t,n){if(null===(e=(e=Vector.create(e)).to3D()))return null;if(null===(t=(t=Vector.create(t)).to3D()))return null;if(void 0===n)n=null;else if(null===(n=(n=Vector.create(n)).to3D()))return null;var i,r,a=e.elements[0],s=e.elements[1],o=e.elements[2],l=t.elements[0],c=t.elements[1],h=t.elements[2];if(null!==n){var u=n.elements[0],m=n.elements[1],p=n.elements[2];if(0===(r=(i=Vector.create([(c-s)*(p-o)-(h-o)*(m-s),(h-o)*(u-a)-(l-a)*(p-o),(l-a)*(m-s)-(c-s)*(u-a)])).modulus()))return null;i=Vector.create([i.elements[0]/r,i.elements[1]/r,i.elements[2]/r])}else{if(0===(r=Math.sqrt(l*l+c*c+h*h)))return null;i=Vector.create([t.elements[0]/r,t.elements[1]/r,t.elements[2]/r])}return this.anchor=e,this.normal=i,this}},Plane.create=function(e,t,n){return(new Plane).setVectors(e,t,n)},Plane.XY=Plane.create(Vector.Zero(3),Vector.k),Plane.YZ=Plane.create(Vector.Zero(3),Vector.i),Plane.ZX=Plane.create(Vector.Zero(3),Vector.j),Plane.YX=Plane.XY,Plane.ZY=Plane.YZ,Plane.XZ=Plane.ZX;var $V=Vector.create,$M=Matrix.create,$L=Line.create,$P=Plane.create;function addWheelHandler(e,t){e.addEventListener?"onwheel"in document?e.addEventListener("wheel",t,!1):"onmousewheel"in document?e.addEventListener("mousewheel",t,!1):e.addEventListener("MozMousePixelScroll",t,!1):e.attachEvent("onmousewheel",t)}function clampMapPan(){var e=document.getElementById("map-canvas");map_pan[0]=clamp(map_pan[0],-(map_scale-1)*e.width,0),map_pan[1]=clamp(map_pan[1],-(map_scale-1)*e.height,0)}function mapOnWheel(e){var t=(e=e||window.event).wheelDelta?e.wheelDelta:-40*(e.deltaY||e.detail);t*=.8*map_scale;var n=null!=e.offsetX?e.offsetX:e.pageX-$("#map-canvas").offset().left,i=null!=e.offsetY?e.offsetY:e.pageY-$("#map-canvas").offset().top;map_scale_new=clamp(map_scale+.001*t,1,15),map_pan[0]=n-(n-map_pan[0])*map_scale_new/map_scale,map_pan[1]=i-(i-map_pan[1])*map_scale_new/map_scale,map_scale=map_scale_new,clampMapPan(),redraw_map(0),e.preventDefault?e.preventDefault():e.returnValue=!1}function on_touch_event(e){if(e.gesture){if("dragstart"==e.type)isDraggingMap=!0;else if("transformstart"==e.type)isTransformingMap=!0;else if("dragend"==e.type)isDraggingMap=!1;else if("transformend"==e.type)isTransformingMap=!1;else{if("drag"!=e.type&&"transform"!=e.type)return console.log("Unexpected event type"),void console.log(e);if("transform"==e.type){scale0=map_scale,map_scale=clamp(map_scale*e.gesture.scale/prevScale,1,3);var t=e.gesture.center.pageX-$("#map-canvas").offset().left,n=e.gesture.center.pageY-$("#map-canvas").offset().top;map_pan[0]=t-(t-map_pan[0])*map_scale/scale0,map_pan[1]=n-(n-map_pan[1])*map_scale/scale0}map_pan[0]+=e.gesture.center.pageX-prevMousePos[0],map_pan[1]+=e.gesture.center.pageY-prevMousePos[1],clampMapPan(),redraw_map(0)}prevMousePos=[e.gesture.center.pageX,e.gesture.center.pageY],prevScale=e.gesture.scale}}function calcMapObjectColor(e){if("blink"in e&&e.blink){var t=2==e.blink?blinkHeavyVal:blinkNormalVal,n=e["color[]"],i=[255,255,0];return rgb_to_hex(Math.floor(lerp(n[0],i[0],t)),Math.floor(lerp(n[1],i[1],t)),Math.floor(lerp(n[2],i[2],t)))}return e.color}function drawMapGrid(e){if(map_info&&"map_min"in map_info){var t=e.getContext("2d"),n=e.width,i=e.height,r=map_info.map_min,a=map_info.map_max,s=n/(a[0]-r[0]),o=i/(a[1]-r[1]);t.lineWidth=1,t.strokeStyle="#555",t.beginPath();for(var l=r[1];l<=a[1];l+=map_info.grid_steps[1]){var c=Math.floor((l-r[1])*o)+.5;t.moveTo(0,c),t.lineTo(n,c)}for(var h=r[0];h<=a[0];h+=map_info.grid_steps[0]){var u=Math.floor((h-r[0])*s)+.5;t.moveTo(u,0),t.lineTo(u,i)}t.stroke(),t.fillStyle="#111",t.font="normal 9pt sans-serif",t.textBaseline="middle",t.textAlign="left",l=r[1]+.5*map_info.grid_steps[1];for(var m=0;l<=a[1]&&m<26;l+=map_info.grid_steps[1],++m)c=Math.floor((l-r[1])*o)+.5,t.fillText(String.fromCharCode(65+m),3,c);for(t.textBaseline="top",t.textAlign="center",h=r[0]+.5*map_info.grid_steps[0],m=1;h<=a[0];h+=map_info.grid_steps[0],++m)u=Math.floor((h-r[0])*s)+.5,t.fillText(m,u,3)}}function drawMapGridScaled(e){if(map_info&&"map_min"in map_info){var t=e.getContext("2d"),n=e.width,i=e.height,r=map_info.map_min,a=map_info.map_max,s=map_info.grid_steps,o=n*map_scale/(a[0]-r[0]),l=i*map_scale/(a[1]-r[1]),c=Math.floor(-map_pan[0]/o/s[0]),h=Math.floor(-map_pan[1]/l/s[1]),u=r[0]+c*s[0],m=r[1]+h*s[1],p=r[0]+Math.ceil((n-map_pan[0])/o/s[0])*s[0],d=r[1]+Math.ceil((i-map_pan[1])/l/s[1])*s[1];t.lineWidth=1,t.strokeStyle="#555",t.beginPath();for(var g=m;g<=d;g+=s[1]){var f=Math.floor((g-r[1])*l+map_pan[1])+.5;t.moveTo(0,f),t.lineTo(n,f)}for(var v=u;v<=p;v+=s[0]){var _=Math.floor((v-r[0])*o+map_pan[0])+.5;t.moveTo(_,0),t.lineTo(_,i)}t.stroke(),t.fillStyle="#111",t.font="normal 9pt sans-serif",t.textBaseline="middle",t.textAlign="left",g=m+.5*map_info.grid_steps[1];for(var y=h;g<=d&&y<26;g+=s[1],++y)f=Math.floor((g-r[1])*l+map_pan[1])+.5,t.fillText(String.fromCharCode(65+y),3,f);for(t.textBaseline="top",t.textAlign="center",v=u+.5*map_info.grid_steps[0],y=c;v<=p;v+=s[0],++y)_=Math.floor((v-r[0])*o+map_pan[0])+.5,t.fillText(y+1,_,3)}}function draw_airfield(e,t,n){var i=e.width*n.sx*map_scale+map_pan[0],r=e.height*n.sy*map_scale+map_pan[1],a=e.width*n.ex*map_scale+map_pan[0],s=e.height*n.ey*map_scale+map_pan[1];t.lineWidth=3*Math.sqrt(map_scale),t.strokeStyle=calcMapObjectColor(n),t.beginPath(),t.moveTo(i,r),t.lineTo(a,s),t.stroke()}function draw_player(e,t,n,i){var r=n.x,a=n.y,s=$V([n.dx,n.dy]);if(lastPlayerPos){var o=lastPlayerPos.x,l=lastPlayerPos.y;Math.abs(o-r)<.01&&(r=approach(o,r,i,.4)),Math.abs(l-a)<.01&&(a=approach(l,a,i,.4));var c=$V(lastPlayerPos.dir),h=s.signedAngle2DFrom(c);h>.25*-Math.PI&&h<.25*Math.PI&&(h=approach(0,h,i,.4),s=c.rotate(h,[0,0]))}t.fillStyle="#fff",t.lineWidth=2,t.strokeStyle="#333",t.beginPath();var u=s.at(0),m=s.at(1),p=r*e.width*map_scale+map_pan[0],d=a*e.height*map_scale+map_pan[1];return t.moveTo((p-=5*u)-4*m,(d-=5*m)+4*u),t.lineTo(p+4*m,d-4*u),t.lineTo(p+10*u,d+10*m),t.closePath(),t.fill(),t.stroke(),{x:r,y:a,dir:s.elements}}function draw_map_object(e,t,n,i){var r=e.width*n.x,a=e.height*n.y;t.fillStyle=calcMapObjectColor(n),t.lineWidth=1,t.strokeStyle="#000",t.font="bold 18pt Icons",t.textBaseline="middle",t.textAlign="center";var s,o=r*map_scale+map_pan[0],l=a*map_scale+map_pan[1];if(s="Airdefence"==n.icon?"4":"Structure"==n.icon?"5":"waypoint"==n.icon?"6":"capture_zone"==n.icon?"7":"bombing_point"==n.icon?"8":"defending_point"==n.icon?"9":"respawn_base_tank"==n.icon?"0":"respawn_base_fighter"==n.icon?".":"respawn_base_bomber"==n.icon?":":n.icon[0],i){t.save(),t.translate(o,l);var c=Math.atan2(n.dx,-n.dy);t.rotate(c),t.translate(-o,-l),t.fillText(s,o,l),t.strokeText(s,o,l),t.restore()}else t.fillText(s,o,l),t.strokeText(s,o,l)}function redraw_map(e){var t=document.getElementById("map-canvas"),n=t.getContext("2d");n.clearRect(0,0,t.width,t.height),n.setTransform(map_scale,0,0,map_scale,map_pan[0],map_pan[1]),map_image.complete&&map_image.naturalWidth&&n.drawImage(map_image,0,0,t.width,t.height),n.setTransform(1,0,0,1,0,0),drawMapGridScaled(t);var i=null;if($.isArray(map_objects))for(var r=0;r<map_objects.length;++r){var a=map_objects[r];"airfield"==a.type?draw_airfield(t,n,a):"Player"==a.icon?i=a:draw_map_object(t,n,a,"respawn_base_fighter"==a.type||"respawn_base_bomber"==a.type)}lastPlayerPos=i?draw_player(t,n,i,e):null}function update_timers(){var e=(new Date).getTime(),t=0;return lastT&&(t=.001*(e-lastT),blinkNormalT+=t,blinkHeavyT+=t,blinkNormalT>2&&(blinkNormalT-=2*Math.floor(blinkNormalT/2)),blinkHeavyT>1.2&&(blinkHeavyT-=1.2*Math.floor(blinkHeavyT/1.2)),blinkNormalVal=Math.exp(-Math.pow(5*blinkNormalT-2,4)),blinkHeavyVal=Math.exp(-Math.pow(5*blinkHeavyT-2,4))),lastT=e,t}function update_object_positions(e){map_objects=e,redraw_map(update_timers())}function update_map_info(e){var t=map_info&&"map_generation"in map_info?map_info.map_generation:-1,n=e&&"map_generation"in e?e.map_generation:-1;if(map_info=e,t!=n){const e=localStorage.getItem("endpoint")||"http://localhost:8111";map_image.src=e+"/map.img?gen="+n,map_scale=1,map_pan=[0,0],redraw_map(0)}}function updateSlow(){const e=localStorage.getItem("endpoint")||"http://localhost:8111";if(window.isSiteActive){$.ajax({type:"GET",url:e+"/map_obj.json",success:update_object_positions}),$.ajax({type:"GET",url:e+"/map_info.json",success:update_map_info});const t=$("canvas#map-canvas"),n=t.width();t.css("height",n)}}function updateFast(){var e=update_timers();isDraggingMap||isTransformingMap||redraw_map(e)}function normalizeText(e){return e.replace("<","&lt;").replace(">","&gt;")}function localize_static(){for(var e=$(".loc"),t=e.length,n=0;n<t;++n){var i=$(e[n]),r=i.text();r in loc_tbl&&i.text(loc_tbl[r])}}function lerp(e,t,n){return e*(1-n)+t*n}function clamp(e,t,n){return Math.max(t,Math.min(e,n))}function approach(e,t,n,i){return i<1e-9?t:e+(1-Math.exp(-n/i))*(t-e)}function rgb_to_hex(e,t,n){var i=e.toString(16),r=t.toString(16),a=n.toString(16);return"#"+(1==i.length?"0"+i:i)+(1==r.length?"0"+r:r)+(1==a.length?"0"+a:a)}function get_pos_prop(e,t){return"width"==t||"height"==t?e[t]():e.offset()[t]}function set_pos_prop(e,t,n){if("width"==t||"height"==t)return e[t](n);var i=e.offset();i[t]=n,e.offset(i)}function load_positions(){for(var e in pos_save_elem_ids){var t=Cookies.get(e);if(t){var n=$(e),i=t.split("|");for(var r in i){var a=i[r].split(":");2==a.length&&set_pos_prop(n,a[0],a[1])}}}var s=$("#map-canvas");s.get(0).width=s.width(),s.get(0).height=s.height()}function save_positions(){for(var e in pos_save_elem_ids){var t=$(e),n=pos_save_elem_ids[e],i="";for(var r in n)i&&(i+="|"),i+=n[r]+":"+get_pos_prop(t,n[r]);i&&Cookies.set(e,i,{expires:cookieLifeTime})}}function init(){localize_static();var e=document.getElementById("map-canvas");addWheelHandler(e,mapOnWheel),e.onselectstart=function(){return!1};var t=Hammer(e,hammer_opt),n=["drag","dragstart","dragend","transform","transformstart","transformend"];for(var i in n)t.on(n[i],on_touch_event);load_positions(),$("#map-root").draggable({handle:"#draghandle",stop:save_positions}),"file:"!=document.location.protocol&&(setInterval(updateSlow,500),setInterval(updateFast,25))}function resizeResizables(){const e=$("nav.navbar").height()+$("div#instrument-div").height()+$(".card-header").height()+100,t=$(window).height()-e;$(".resizable-div").each(function(){$(this).height(t+"px"),$(this).css("min-height","20em")})}function timeSince(e){var t=((new Date).getTime()-e)/1e3;return parseInt(t)+"s ago"}function showNotification(e,t,n,i,r,a){$.notify({message:n},{type:i,timer:r,placement:{from:e,align:t},allow_dismiss:a})}map_objects=null,map_info=null,map_image=new Image,cookieLifeTime=864e5,map_scale=1,map_pan=[0,0],prevMousePos=null,prevScale=null,lastT=null,blinkNormalT=0,blinkHeavyT=0,blinkNormalVal=0,blinkHeavyVal=0,lastPlayerPos=null,isDraggingMap=!1,isTransformingMap=!1,hammer_opt={hold:!1,tap:!1,doubletap:!1,drag:!0,dragstart:!0,dragend:!0,dragup:!1,dragdown:!1,dragleft:!1,dragright:!1,swipe:!1,swipeup:!1,swipedown:!1,swipeleft:!1,swiperight:!1,transform:!0,transformstart:!0,transformend:!0,rotate:!1,pinch:!1,pinchin:!1,pinchout:!1,prevent_default:!0,no_mouseevents:!0},Array.indexOf||(Array.prototype.indexOf=function(e){for(var t=0;t<this.length;t++)if(this[t]==e)return t;return-1}),pos_save_elem_ids={"#map-root":["left","top"],"#map-canvas":["width","height"]},window.onload=init,function(e,t){"use strict";var n=function(e,t){return new n.Instance(e,t||{})};n.defaults={stop_browser_behavior:{userSelect:"none",touchAction:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},n.HAS_POINTEREVENTS=navigator.pointerEnabled||navigator.msPointerEnabled,n.HAS_TOUCHEVENTS="ontouchstart"in e,n.MOBILE_REGEX=/mobile|tablet|ip(ad|hone|od)|android/i,n.NO_MOUSEEVENTS=n.HAS_TOUCHEVENTS&&navigator.userAgent.match(n.MOBILE_REGEX),n.EVENT_TYPES={},n.DIRECTION_DOWN="down",n.DIRECTION_LEFT="left",n.DIRECTION_UP="up",n.DIRECTION_RIGHT="right",n.POINTER_MOUSE="mouse",n.POINTER_TOUCH="touch",n.POINTER_PEN="pen",n.EVENT_START="start",n.EVENT_MOVE="move",n.EVENT_END="end",n.DOCUMENT=document,n.plugins={},n.READY=!1,n.Instance=function(e,t){var i=this;return function(){if(!n.READY){for(var e in n.event.determineEventTypes(),n.gestures)n.gestures.hasOwnProperty(e)&&n.detection.register(n.gestures[e]);n.event.onTouch(n.DOCUMENT,n.EVENT_MOVE,n.detection.detect),n.event.onTouch(n.DOCUMENT,n.EVENT_END,n.detection.detect),n.READY=!0}}(),this.element=e,this.enabled=!0,this.options=n.utils.extend(n.utils.extend({},n.defaults),t||{}),this.options.stop_browser_behavior&&n.utils.stopDefaultBrowserBehavior(this.element,this.options.stop_browser_behavior),n.event.onTouch(e,n.EVENT_START,function(e){i.enabled&&n.detection.startDetect(i,e)}),this},n.Instance.prototype={on:function(e,t){for(var n=e.split(" "),i=0;n.length>i;i++)this.element.addEventListener(n[i],t,!1);return this},off:function(e,t){for(var n=e.split(" "),i=0;n.length>i;i++)this.element.removeEventListener(n[i],t,!1);return this},trigger:function(e,t){var i=n.DOCUMENT.createEvent("Event");i.initEvent(e,!0,!0),i.gesture=t;var r=this.element;return n.utils.hasParent(t.target,r)&&(r=t.target),r.dispatchEvent(i),this},enable:function(e){return this.enabled=e,this}};var i=null,r=!1,a=!1;n.event={bindDom:function(e,t,n){for(var i=t.split(" "),r=0;i.length>r;r++)e.addEventListener(i[r],n,!1)},onTouch:function(e,t,s){var o=this;this.bindDom(e,n.EVENT_TYPES[t],function(l){var c=l.type.toLowerCase();if(!c.match(/mouse/)||!a){(c.match(/touch/)||c.match(/pointerdown/)||c.match(/mouse/)&&1===l.which)&&(r=!0),c.match(/touch|pointer/)&&(a=!0);var h=0;r&&(n.HAS_POINTEREVENTS&&t!=n.EVENT_END?h=n.PointerEvent.updatePointer(t,l):c.match(/touch/)?h=l.touches.length:a||(h=c.match(/up/)?0:1),h>0&&t==n.EVENT_END?t=n.EVENT_MOVE:h||(t=n.EVENT_END),h||null===i?i=l:l=i,s.call(n.detection,o.collectEventData(e,t,l)),n.HAS_POINTEREVENTS&&t==n.EVENT_END&&(h=n.PointerEvent.updatePointer(t,l))),h||(i=null,r=!1,a=!1,n.PointerEvent.reset())}})},determineEventTypes:function(){var e;e=n.HAS_POINTEREVENTS?n.PointerEvent.getEvents():n.NO_MOUSEEVENTS?["touchstart","touchmove","touchend touchcancel"]:["touchstart mousedown","touchmove mousemove","touchend touchcancel mouseup"],n.EVENT_TYPES[n.EVENT_START]=e[0],n.EVENT_TYPES[n.EVENT_MOVE]=e[1],n.EVENT_TYPES[n.EVENT_END]=e[2]},getTouchList:function(e){return n.HAS_POINTEREVENTS?n.PointerEvent.getTouchList():e.touches?e.touches:[{identifier:1,pageX:e.pageX,pageY:e.pageY,target:e.target}]},collectEventData:function(e,t,i){var r=this.getTouchList(i,t),a=n.POINTER_TOUCH;return(i.type.match(/mouse/)||n.PointerEvent.matchType(n.POINTER_MOUSE,i))&&(a=n.POINTER_MOUSE),{center:n.utils.getCenter(r),timeStamp:(new Date).getTime(),target:i.target,touches:r,eventType:t,pointerType:a,srcEvent:i,preventDefault:function(){this.srcEvent.preventManipulation&&this.srcEvent.preventManipulation(),this.srcEvent.preventDefault&&this.srcEvent.preventDefault()},stopPropagation:function(){this.srcEvent.stopPropagation()},stopDetect:function(){return n.detection.stopDetect()}}}},n.PointerEvent={pointers:{},getTouchList:function(){var e=this,t=[];return Object.keys(e.pointers).sort().forEach(function(n){t.push(e.pointers[n])}),t},updatePointer:function(e,t){return e==n.EVENT_END?this.pointers={}:(t.identifier=t.pointerId,this.pointers[t.pointerId]=t),Object.keys(this.pointers).length},matchType:function(e,t){if(!t.pointerType)return!1;var i={};return i[n.POINTER_MOUSE]=t.pointerType==t.MSPOINTER_TYPE_MOUSE||t.pointerType==n.POINTER_MOUSE,i[n.POINTER_TOUCH]=t.pointerType==t.MSPOINTER_TYPE_TOUCH||t.pointerType==n.POINTER_TOUCH,i[n.POINTER_PEN]=t.pointerType==t.MSPOINTER_TYPE_PEN||t.pointerType==n.POINTER_PEN,i[e]},getEvents:function(){return["pointerdown MSPointerDown","pointermove MSPointerMove","pointerup pointercancel MSPointerUp MSPointerCancel"]},reset:function(){this.pointers={}}},n.utils={extend:function(e,n,i){for(var r in n)e[r]!==t&&i||(e[r]=n[r]);return e},hasParent:function(e,t){for(;e;){if(e==t)return!0;e=e.parentNode}return!1},getCenter:function(e){for(var t=[],n=[],i=0,r=e.length;r>i;i++)t.push(e[i].pageX),n.push(e[i].pageY);return{pageX:(Math.min.apply(Math,t)+Math.max.apply(Math,t))/2,pageY:(Math.min.apply(Math,n)+Math.max.apply(Math,n))/2}},getVelocity:function(e,t,n){return{x:Math.abs(t/e)||0,y:Math.abs(n/e)||0}},getAngle:function(e,t){return 180*Math.atan2(t.pageY-e.pageY,t.pageX-e.pageX)/Math.PI},getDirection:function(e,t){return Math.abs(e.pageX-t.pageX)>=Math.abs(e.pageY-t.pageY)?e.pageX-t.pageX>0?n.DIRECTION_LEFT:n.DIRECTION_RIGHT:e.pageY-t.pageY>0?n.DIRECTION_UP:n.DIRECTION_DOWN},getDistance:function(e,t){var n=t.pageX-e.pageX,i=t.pageY-e.pageY;return Math.sqrt(n*n+i*i)},getScale:function(e,t){return e.length>=2&&t.length>=2?this.getDistance(t[0],t[1])/this.getDistance(e[0],e[1]):1},getRotation:function(e,t){return e.length>=2&&t.length>=2?this.getAngle(t[1],t[0])-this.getAngle(e[1],e[0]):0},isVertical:function(e){return e==n.DIRECTION_UP||e==n.DIRECTION_DOWN},stopDefaultBrowserBehavior:function(e,t){var n,i=["webkit","khtml","moz","ms","o",""];if(t&&e.style){for(var r=0;i.length>r;r++)for(var a in t)t.hasOwnProperty(a)&&(n=a,i[r]&&(n=i[r]+n.substring(0,1).toUpperCase()+n.substring(1)),e.style[n]=t[a]);"none"==t.userSelect&&(e.onselectstart=function(){return!1})}}},n.detection={gestures:[],current:null,previous:null,stopped:!1,startDetect:function(e,t){this.current||(this.stopped=!1,this.current={inst:e,startEvent:n.utils.extend({},t),lastEvent:!1,name:""},this.detect(t))},detect:function(e){if(this.current&&!this.stopped){e=this.extendEventData(e);for(var t=this.current.inst.options,i=0,r=this.gestures.length;r>i;i++){var a=this.gestures[i];if(!this.stopped&&!1!==t[a.name]&&!1===a.handler.call(a,e,this.current.inst)){this.stopDetect();break}}return this.current&&(this.current.lastEvent=e),e.eventType==n.EVENT_END&&!e.touches.length-1&&this.stopDetect(),e}},stopDetect:function(){this.previous=n.utils.extend({},this.current),this.current=null,this.stopped=!0},extendEventData:function(e){var t=this.current.startEvent;if(t&&(e.touches.length!=t.touches.length||e.touches===t.touches)){t.touches=[];for(var i=0,r=e.touches.length;r>i;i++)t.touches.push(n.utils.extend({},e.touches[i]))}var a=e.timeStamp-t.timeStamp,s=e.center.pageX-t.center.pageX,o=e.center.pageY-t.center.pageY,l=n.utils.getVelocity(a,s,o);return n.utils.extend(e,{deltaTime:a,deltaX:s,deltaY:o,velocityX:l.x,velocityY:l.y,distance:n.utils.getDistance(t.center,e.center),angle:n.utils.getAngle(t.center,e.center),direction:n.utils.getDirection(t.center,e.center),scale:n.utils.getScale(t.touches,e.touches),rotation:n.utils.getRotation(t.touches,e.touches),startEvent:t}),e},register:function(e){var i=e.defaults||{};return i[e.name]===t&&(i[e.name]=!0),n.utils.extend(n.defaults,i,!0),e.index=e.index||1e3,this.gestures.push(e),this.gestures.sort(function(e,t){return e.index<t.index?-1:e.index>t.index?1:0}),this.gestures}},n.gestures=n.gestures||{},n.gestures.Hold={name:"hold",index:10,defaults:{hold_timeout:500,hold_threshold:1},timer:null,handler:function(e,t){switch(e.eventType){case n.EVENT_START:clearTimeout(this.timer),n.detection.current.name=this.name,this.timer=setTimeout(function(){"hold"==n.detection.current.name&&t.trigger("hold",e)},t.options.hold_timeout);break;case n.EVENT_MOVE:e.distance>t.options.hold_threshold&&clearTimeout(this.timer);break;case n.EVENT_END:clearTimeout(this.timer)}}},n.gestures.Tap={name:"tap",index:100,defaults:{tap_max_touchtime:250,tap_max_distance:10,tap_always:!0,doubletap_distance:20,doubletap_interval:300},handler:function(e,t){if(e.eventType==n.EVENT_END){var i=n.detection.previous,r=!1;if(e.deltaTime>t.options.tap_max_touchtime||e.distance>t.options.tap_max_distance)return;i&&"tap"==i.name&&e.timeStamp-i.lastEvent.timeStamp<t.options.doubletap_interval&&e.distance<t.options.doubletap_distance&&(t.trigger("doubletap",e),r=!0),(!r||t.options.tap_always)&&(n.detection.current.name="tap",t.trigger(n.detection.current.name,e))}}},n.gestures.Swipe={name:"swipe",index:40,defaults:{swipe_max_touches:1,swipe_velocity:.7},handler:function(e,t){if(e.eventType==n.EVENT_END){if(t.options.swipe_max_touches>0&&e.touches.length>t.options.swipe_max_touches)return;(e.velocityX>t.options.swipe_velocity||e.velocityY>t.options.swipe_velocity)&&(t.trigger(this.name,e),t.trigger(this.name+e.direction,e))}}},n.gestures.Drag={name:"drag",index:50,defaults:{drag_min_distance:10,drag_max_touches:1,drag_block_horizontal:!1,drag_block_vertical:!1,drag_lock_to_axis:!1,drag_lock_min_distance:25},triggered:!1,handler:function(e,i){if(n.detection.current.name!=this.name&&this.triggered)return i.trigger(this.name+"end",e),this.triggered=!1,t;if(!(i.options.drag_max_touches>0&&e.touches.length>i.options.drag_max_touches))switch(e.eventType){case n.EVENT_START:this.triggered=!1;break;case n.EVENT_MOVE:if(e.distance<i.options.drag_min_distance&&n.detection.current.name!=this.name)return;n.detection.current.name=this.name,(n.detection.current.lastEvent.drag_locked_to_axis||i.options.drag_lock_to_axis&&i.options.drag_lock_min_distance<=e.distance)&&(e.drag_locked_to_axis=!0);var r=n.detection.current.lastEvent.direction;e.drag_locked_to_axis&&r!==e.direction&&(e.direction=n.utils.isVertical(r)?0>e.deltaY?n.DIRECTION_UP:n.DIRECTION_DOWN:0>e.deltaX?n.DIRECTION_LEFT:n.DIRECTION_RIGHT),this.triggered||(i.trigger(this.name+"start",e),this.triggered=!0),i.trigger(this.name,e),i.trigger(this.name+e.direction,e),(i.options.drag_block_vertical&&n.utils.isVertical(e.direction)||i.options.drag_block_horizontal&&!n.utils.isVertical(e.direction))&&e.preventDefault();break;case n.EVENT_END:this.triggered&&i.trigger(this.name+"end",e),this.triggered=!1}}},n.gestures.Transform={name:"transform",index:45,defaults:{transform_min_scale:.01,transform_min_rotation:1,transform_always_block:!1},triggered:!1,handler:function(e,i){if(n.detection.current.name!=this.name&&this.triggered)return i.trigger(this.name+"end",e),this.triggered=!1,t;if(!(2>e.touches.length))switch(i.options.transform_always_block&&e.preventDefault(),e.eventType){case n.EVENT_START:this.triggered=!1;break;case n.EVENT_MOVE:var r=Math.abs(1-e.scale),a=Math.abs(e.rotation);if(i.options.transform_min_scale>r&&i.options.transform_min_rotation>a)return;n.detection.current.name=this.name,this.triggered||(i.trigger(this.name+"start",e),this.triggered=!0),i.trigger(this.name,e),a>i.options.transform_min_rotation&&i.trigger("rotate",e),r>i.options.transform_min_scale&&(i.trigger("pinch",e),i.trigger("pinch"+(1>e.scale?"in":"out"),e));break;case n.EVENT_END:this.triggered&&i.trigger(this.name+"end",e),this.triggered=!1}}},n.gestures.Touch={name:"touch",index:-1/0,defaults:{prevent_default:!1,prevent_mouseevents:!1},handler:function(e,i){return i.options.prevent_mouseevents&&e.pointerType==n.POINTER_MOUSE?(e.stopDetect(),t):(i.options.prevent_default&&e.preventDefault(),e.eventType==n.EVENT_START&&i.trigger(this.name,e),t)}},n.gestures.Release={name:"release",index:1/0,handler:function(e,t){e.eventType==n.EVENT_END&&t.trigger(this.name,e)}},"object"==typeof module&&"object"==typeof module.exports?module.exports=n:(e.Hammer=n,"function"==typeof e.define&&e.define.amd&&e.define("hammer",[],function(){return n}))}(this),function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e("object"==typeof exports?require("jquery"):jQuery)}(function(e){function t(t,i,r){r=e.extend(!0,{},i={content:{message:"object"==typeof i?i.message:i,title:i.title?i.title:"",icon:i.icon?i.icon:"",url:i.url?i.url:"#",target:i.target?i.target:"-"}},r),this.settings=e.extend(!0,{},n,r),this._defaults=n,"-"==this.settings.content.target&&(this.settings.content.target=this.settings.url_target),this.animations={start:"webkitAnimationStart oanimationstart MSAnimationStart animationstart",end:"webkitAnimationEnd oanimationend MSAnimationEnd animationend"},"number"==typeof this.settings.offset&&(this.settings.offset={x:this.settings.offset,y:this.settings.offset}),this.init()}var n={element:"body",position:null,type:"info",allow_dismiss:!0,newest_on_top:!1,showProgressbar:!1,placement:{from:"top",align:"right"},offset:20,spacing:10,z_index:1031,delay:5e3,timer:1e3,url_target:"_blank",mouse_over:null,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"},onShow:null,onShown:null,onClose:null,onClosed:null,icon_type:"class",template:'<div data-notify="container" class="col-xs-11 col-sm-4 alert alert-{0}" role="alert"><button type="button" aria-hidden="true" class="close" data-notify="dismiss">&times;</button><span data-notify="icon"></span> <span data-notify="title">{1}</span> <span data-notify="message">{2}</span><div class="progress" data-notify="progressbar"><div class="progress-bar progress-bar-{0}" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"></div></div><a href="{3}" target="{4}" data-notify="url"></a></div>'};String.format=function(){for(var e=arguments[0],t=1;t<arguments.length;t++)e=e.replace(RegExp("\\{"+(t-1)+"\\}","gm"),arguments[t]);return e},e.extend(t.prototype,{init:function(){var e=this;this.buildNotify(),this.settings.content.icon&&this.setIcon(),"#"!=this.settings.content.url&&this.styleURL(),this.placement(),this.bind(),this.notify={$ele:this.$ele,update:function(t,n){var i={};for(var t in"string"==typeof t?i[t]=n:i=t,i)switch(t){case"type":this.$ele.removeClass("alert-"+e.settings.type),this.$ele.find('[data-notify="progressbar"] > .progress-bar').removeClass("progress-bar-"+e.settings.type),e.settings.type=i[t],this.$ele.addClass("alert-"+i[t]).find('[data-notify="progressbar"] > .progress-bar').addClass("progress-bar-"+i[t]);break;case"icon":var r=this.$ele.find('[data-notify="icon"]');"class"==e.settings.icon_type.toLowerCase()?r.removeClass(e.settings.content.icon).addClass(i[t]):(r.is("img")||r.find("img"),r.attr("src",i[t]));break;case"progress":this.$ele.data("notify-delay",e.settings.delay-e.settings.delay*(i[t]/100)),this.$ele.find('[data-notify="progressbar"] > div').attr("aria-valuenow",i[t]).css("width",i[t]+"%");break;case"url":this.$ele.find('[data-notify="url"]').attr("href",i[t]);break;case"target":this.$ele.find('[data-notify="url"]').attr("target",i[t]);break;default:this.$ele.find('[data-notify="'+t+'"]').html(i[t])}var a=this.$ele.outerHeight()+parseInt(e.settings.spacing)+parseInt(e.settings.offset.y);e.reposition(a)},close:function(){e.close()}}},buildNotify:function(){var t=this.settings.content;this.$ele=e(String.format(this.settings.template,this.settings.type,t.title,t.message,t.url,t.target)),this.$ele.attr("data-notify-position",this.settings.placement.from+"-"+this.settings.placement.align),this.settings.allow_dismiss||this.$ele.find('[data-notify="dismiss"]').css("display","none"),(this.settings.delay<=0&&!this.settings.showProgressbar||!this.settings.showProgressbar)&&this.$ele.find('[data-notify="progressbar"]').remove()},setIcon:function(){"class"==this.settings.icon_type.toLowerCase()?this.$ele.find('[data-notify="icon"]').addClass(this.settings.content.icon):this.$ele.find('[data-notify="icon"]').is("img")?this.$ele.find('[data-notify="icon"]').attr("src",this.settings.content.icon):this.$ele.find('[data-notify="icon"]').append('<img src="'+this.settings.content.icon+'" alt="Notify Icon" />')},styleURL:function(){this.$ele.find('[data-notify="url"]').css({backgroundImage:"url(data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)",height:"100%",left:"0px",position:"absolute",top:"0px",width:"100%",zIndex:this.settings.z_index+1}),this.$ele.find('[data-notify="dismiss"]').css({position:"absolute",right:"10px",top:"5px",zIndex:this.settings.z_index+2})},placement:function(){var t=this,n=this.settings.offset.y,i={display:"inline-block",margin:"0px auto",position:this.settings.position?this.settings.position:"body"===this.settings.element?"fixed":"absolute",transition:"all .5s ease-in-out",zIndex:this.settings.z_index},r=!1,a=this.settings;switch(e('[data-notify-position="'+this.settings.placement.from+"-"+this.settings.placement.align+'"]:not([data-closing="true"])').each(function(){return n=Math.max(n,parseInt(e(this).css(a.placement.from))+parseInt(e(this).outerHeight())+parseInt(a.spacing))}),1==this.settings.newest_on_top&&(n=this.settings.offset.y),i[this.settings.placement.from]=n+"px",this.settings.placement.align){case"left":case"right":i[this.settings.placement.align]=this.settings.offset.x+"px";break;case"center":i.left=0,i.right=0}this.$ele.css(i).addClass(this.settings.animate.enter),e.each(Array("webkit","moz","o","ms",""),function(e,n){t.$ele[0].style[n+"AnimationIterationCount"]=1}),e(this.settings.element).append(this.$ele),1==this.settings.newest_on_top&&(n=parseInt(n)+parseInt(this.settings.spacing)+this.$ele.outerHeight(),this.reposition(n)),e.isFunction(t.settings.onShow)&&t.settings.onShow.call(this.$ele),this.$ele.one(this.animations.start,function(){r=!0}).one(this.animations.end,function(){e.isFunction(t.settings.onShown)&&t.settings.onShown.call(this)}),setTimeout(function(){r||e.isFunction(t.settings.onShown)&&t.settings.onShown.call(this)},600)},bind:function(){var t=this;if(this.$ele.find('[data-notify="dismiss"]').on("click",function(){t.close()}),this.$ele.mouseover(function(){e(this).data("data-hover","true")}).mouseout(function(){e(this).data("data-hover","false")}),this.$ele.data("data-hover","false"),this.settings.delay>0){t.$ele.data("notify-delay",t.settings.delay);var n=setInterval(function(){var e=parseInt(t.$ele.data("notify-delay"))-t.settings.timer;if("false"===t.$ele.data("data-hover")&&"pause"==t.settings.mouse_over||"pause"!=t.settings.mouse_over){var i=(t.settings.delay-e)/t.settings.delay*100;t.$ele.data("notify-delay",e),t.$ele.find('[data-notify="progressbar"] > div').attr("aria-valuenow",i).css("width",i+"%")}e<=-t.settings.timer&&(clearInterval(n),t.close())},t.settings.timer)}},close:function(){var t=this,n=parseInt(this.$ele.css(this.settings.placement.from)),i=!1;this.$ele.data("closing","true").addClass(this.settings.animate.exit),t.reposition(n),e.isFunction(t.settings.onClose)&&t.settings.onClose.call(this.$ele),this.$ele.one(this.animations.start,function(){i=!0}).one(this.animations.end,function(){e(this).remove(),e.isFunction(t.settings.onClosed)&&t.settings.onClosed.call(this)}),setTimeout(function(){i||(t.$ele.remove(),t.settings.onClosed&&t.settings.onClosed(t.$ele))},600)},reposition:function(t){var n=this,i='[data-notify-position="'+this.settings.placement.from+"-"+this.settings.placement.align+'"]:not([data-closing="true"])',r=this.$ele.nextAll(i);1==this.settings.newest_on_top&&(r=this.$ele.prevAll(i)),r.each(function(){e(this).css(n.settings.placement.from,t),t=parseInt(t)+parseInt(n.settings.spacing)+e(this).outerHeight()})}}),e.notify=function(e,n){return new t(this,e,n).notify},e.notifyDefaults=function(t){return n=e.extend(!0,{},n,t)},e.notifyClose=function(t){void 0===t||"all"==t?e("[data-notify]").find('[data-notify="dismiss"]').trigger("click"):e('[data-notify-position="'+t+'"]').find('[data-notify="dismiss"]').trigger("click")}}),$(document).ready(function(){$("#settingsFormLinks a").click(function(e){e.preventDefault(),$(this).tab("show")});let e=$("#playerName"),t=$("#endpoint"),n=$("#squadName"),i=$("#squadSecret"),r=$("#speedSettings"),a=$("#altitudeSettings"),s=$("#distanceSettings"),o=$("#climbSpeedSettings"),l=$("#temperatureSettings");function c(e,t,n,i){return e.val().length>i||e.val().length<n?(e.removeClass("is-valid"),e.addClass("is-invalid"),!1):(e.removeClass("is-invalid"),e.addClass("is-valid"),!0)}$([]).add(e).add(t).add(n).add(i),null!==localStorage.getItem("playerName")&&e.val(localStorage.getItem("playerName")),null!==localStorage.getItem("endpoint")?t.val(localStorage.getItem("endpoint")):t.val("http://localhost:8111"),null!==localStorage.getItem("speedSetting")?r.val(localStorage.getItem("speedSetting")):r.val("km/h"),null!==localStorage.getItem("altitudeSetting")?a.val(localStorage.getItem("altitudeSetting")):a.val("m"),null!==localStorage.getItem("distanceSetting")?s.val(localStorage.getItem("distanceSetting")):s.val("km"),null!==localStorage.getItem("climbSpeedSetting")?o.val(localStorage.getItem("climbSpeedSetting")):o.val("m/sec"),null!==localStorage.getItem("temperatureSetting")?l.val(localStorage.getItem("temperatureSetting")):l.val("C"),null!==localStorage.getItem("squadName")&&n.val(localStorage.getItem("squadName")),null!==localStorage.getItem("squadSecret")&&i.val(localStorage.getItem("squadSecret")),$("#settingsSave").on("click",function(h){h.preventDefault(),function(){let h=!0;return h=h&&c(e,0,1,100),h=h&&c(t,0,6,100),h=h&&c(n,0,1,100),h=h&&c(i,0,1,100),h&&(localStorage.setItem("playerName",e.val()),localStorage.setItem("endpoint",t.val()),null!==localStorage.getItem("playerName")&&e.val(localStorage.getItem("playerName")),null!==localStorage.getItem("endpoint")&&t.val(localStorage.getItem("endpoint")),localStorage.setItem("speedSetting",r.val()),localStorage.setItem("altitudeSetting",a.val()),localStorage.setItem("distanceSetting",s.val()),localStorage.setItem("climbSpeedSetting",o.val()),localStorage.setItem("temperatureSetting",l.val()),$.ajax({async:!1,url:window.restEndpoint+"/squads",type:"POST",data:JSON.stringify({name:n.val(),secret:i.val()}),success:function(e,t,n){switch(n.status){case 200:showNotification("top","right","Joined an existing Squad, enjoy your game!","success",2e3,!1);break;case 201:showNotification("top","right","New Squad setup! Share your Squad Name and Key and get going!","success",3e3,!1)}localStorage.setItem("squadName",$("#squadName").val()),localStorage.setItem("squadSecret",$("#squadSecret").val()),window.initComponentReference.zone.run(()=>{window.initComponentReference.loadAngularFunction()})},error:function(e,t,n){switch(e.status){case 409:i.addClass("is-invalid"),h=!1,showNotification("top","right","Incorrect Secret","danger",2500,!1);break;default:showNotification("top","right",n,"danger",4e3,!1),h=!1}}})),h}()&&$("#settingsModal").modal("hide")}),$("#settingsModal").modal();var h=localStorage.getItem("showAlways"),u=localStorage.getItem("showMyInstruments");null!=h&&"true"===h?$("#showAlways").prop("checked",!0):$("#showAlways").prop("checked",!1),null!=u&&"true"===u?$("#showMyInstruments").prop("checked",!0):$("#showMyInstruments").prop("checked",!1),$("#showAlways").on("change",function(){$(this).is(":checked")?localStorage.setItem("showAlways",!0):localStorage.setItem("showAlways",!1)}),$("#showMyInstruments").on("change",function(){$(this).is(":checked")?localStorage.setItem("showMyInstruments",!0):localStorage.setItem("showMyInstruments",!1)}),setInterval(function(){$(".hidden-last-seen").each(function(){var e=$(this).text();$(this).prev(".show-last-seen").text(timeSince(e))})},2e3),$.fn.sparkline.defaults.common.height="50px",$.fn.sparkline.defaults.common.width="150px",$.fn.sparkline.defaults.common.fillColor="#4b75cf",$.fn.sparkline.defaults.common.lineColor="#4b75cf",resizeResizables(),$(window).on("resize",function(){resizeResizables()})});