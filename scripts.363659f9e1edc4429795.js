!function(e){"use strict";var t=function(e,n,r){return 1===arguments.length?t.get(e):t.set(e,n,r)};t._document=document,t._navigator=navigator,t.defaults={path:"/"},t.get=function(e){return t._cachedDocumentCookie!==t._document.cookie&&t._renewCache(),t._cache[e]},t.set=function(n,r,i){return(i=t._getExtendedOptions(i)).expires=t._getExpiresDate(r===e?-1:i.expires),t._document.cookie=t._generateCookieString(n,r,i),t},t.expire=function(n,r){return t.set(n,e,r)},t._getExtendedOptions=function(n){return{path:n&&n.path||t.defaults.path,domain:n&&n.domain||t.defaults.domain,expires:n&&n.expires||t.defaults.expires,secure:n&&n.secure!==e?n.secure:t.defaults.secure}},t._isValidDate=function(e){return"[object Date]"===Object.prototype.toString.call(e)&&!isNaN(e.getTime())},t._getExpiresDate=function(e,n){switch(n=n||new Date,typeof e){case"number":e=new Date(n.getTime()+1e3*e);break;case"string":e=new Date(e)}if(e&&!t._isValidDate(e))throw new Error("`expires` parameter cannot be converted to a valid Date instance");return e},t._generateCookieString=function(e,t,n){var r=(e=encodeURIComponent(e))+"="+(t=(t+"").replace(/[^!#$&-+\--:<-\[\]-~]/g,encodeURIComponent));return r+=(n=n||{}).path?";path="+n.path:"",r+=n.domain?";domain="+n.domain:"",(r+=n.expires?";expires="+n.expires.toGMTString():"")+(n.secure?";secure":"")},t._getCookieObjectFromString=function(n){for(var r={},i=n?n.split("; "):[],a=0;a<i.length;a++){var s=t._getKeyValuePairFromCookieString(i[a]);r[s.key]===e&&(r[s.key]=s.value)}return r},t._getKeyValuePairFromCookieString=function(e){var t=e.indexOf("=");return t=t<0?e.length:t,{key:decodeURIComponent(e.substr(0,t)),value:decodeURIComponent(e.substr(t+1))}},t._renewCache=function(){t._cache=t._getCookieObjectFromString(t._document.cookie),t._cachedDocumentCookie=t._document.cookie},t._areEnabled=function(){return t._navigator.cookieEnabled||"1"===t.set("cookies.js",1).get("cookies.js")},t.enabled=t._areEnabled(),"function"==typeof define&&define.amd?define(function(){return t}):"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=t),exports.Cookies=t):window.Cookies=t}();var Sylvester={version:"0.1.3",precision:1e-6};function Vector(){}function Matrix(){}function Line(){}function Plane(){}Vector.prototype={e:function(e){return e<1||e>this.elements.length?null:this.elements[e-1]},at:function(e){return e<0||e>=this.elements.length?null:this.elements[e]},dimensions:function(){return this.elements.length},modulus:function(){return Math.sqrt(this.dot(this))},eql:function(e){var t=this.elements.length,n=e.elements||e;if(t!=n.length)return!1;do{if(Math.abs(this.elements[t-1]-n[t-1])>Sylvester.precision)return!1}while(--t);return!0},dup:function(){return Vector.create(this.elements)},map:function(e){var t=[];return this.each(function(n,r){t.push(e(n,r))}),Vector.create(t)},each:function(e){var t,n=this.elements.length,r=n;do{e(this.elements[t=r-n],t+1)}while(--n)},toUnitVector:function(){var e=this.modulus();return 0===e?this.dup():this.map(function(t){return t/e})},angleFrom:function(e){var t=e.elements||e;if(this.elements.length!=t.length)return null;var n=0,r=0,i=0;if(this.each(function(e,a){n+=e*t[a-1],r+=e*e,i+=t[a-1]*t[a-1]}),r=Math.sqrt(r),i=Math.sqrt(i),r*i==0)return null;var a=n/(r*i);return a<-1&&(a=-1),a>1&&(a=1),Math.acos(a)},signedAngle2DFrom:function(e){var t=this.elements,n=e.elements||e;return 2!=n.length||2!=t.length?null:Math.atan2(n[0]*t[1]-n[1]*t[0],n[0]*t[0]+n[1]*t[1])},isParallelTo:function(e){var t=this.angleFrom(e);return null===t?null:t<=Sylvester.precision},isAntiparallelTo:function(e){var t=this.angleFrom(e);return null===t?null:Math.abs(t-Math.PI)<=Sylvester.precision},isPerpendicularTo:function(e){var t=this.dot(e);return null===t?null:Math.abs(t)<=Sylvester.precision},add:function(e){var t=e.elements||e;return this.elements.length!=t.length?null:this.map(function(e,n){return e+t[n-1]})},subtract:function(e){var t=e.elements||e;return this.elements.length!=t.length?null:this.map(function(e,n){return e-t[n-1]})},multiply:function(e){return this.map(function(t){return t*e})},x:function(e){return this.multiply(e)},dot:function(e){var t=e.elements||e,n=0,r=this.elements.length;if(r!=t.length)return null;do{n+=this.elements[r-1]*t[r-1]}while(--r);return n},cross:function(e){var t=e.elements||e;if(3!=this.elements.length||3!=t.length)return null;var n=this.elements;return Vector.create([n[1]*t[2]-n[2]*t[1],n[2]*t[0]-n[0]*t[2],n[0]*t[1]-n[1]*t[0]])},max:function(){var e,t=0,n=this.elements.length,r=n;do{e=r-n,Math.abs(this.elements[e])>Math.abs(t)&&(t=this.elements[e])}while(--n);return t},indexOf:function(e){var t,n=null,r=this.elements.length,i=r;do{t=i-r,null===n&&this.elements[t]==e&&(n=t+1)}while(--r);return n},toDiagonalMatrix:function(){return Matrix.Diagonal(this.elements)},round:function(){return this.map(function(e){return Math.round(e)})},snapTo:function(e){return this.map(function(t){return Math.abs(t-e)<=Sylvester.precision?e:t})},distanceFrom:function(e){if(e.anchor)return e.distanceFrom(this);var t=e.elements||e;if(t.length!=this.elements.length)return null;var n,r=0;return this.each(function(e,i){r+=(n=e-t[i-1])*n}),Math.sqrt(r)},liesOn:function(e){return e.contains(this)},liesIn:function(e){return e.contains(this)},rotate:function(e,t){var n,r,i,a,s;switch(this.elements.length){case 2:return 2!=(n=t.elements||t).length?null:(r=Matrix.Rotation(e).elements,Vector.create([n[0]+r[0][0]*(i=this.elements[0]-n[0])+r[0][1]*(a=this.elements[1]-n[1]),n[1]+r[1][0]*i+r[1][1]*a]));case 3:if(!t.direction)return null;var o=t.pointClosestTo(this).elements;return r=Matrix.Rotation(e,t.direction).elements,Vector.create([o[0]+r[0][0]*(i=this.elements[0]-o[0])+r[0][1]*(a=this.elements[1]-o[1])+r[0][2]*(s=this.elements[2]-o[2]),o[1]+r[1][0]*i+r[1][1]*a+r[1][2]*s,o[2]+r[2][0]*i+r[2][1]*a+r[2][2]*s]);default:return null}},reflectionIn:function(e){if(e.anchor){var t=this.elements.slice(),n=e.pointClosestTo(t).elements;return Vector.create([n[0]+(n[0]-t[0]),n[1]+(n[1]-t[1]),n[2]+(n[2]-(t[2]||0))])}var r=e.elements||e;return this.elements.length!=r.length?null:this.map(function(e,t){return r[t-1]+(r[t-1]-e)})},to3D:function(){var e=this.dup();switch(e.elements.length){case 3:break;case 2:e.elements.push(0);break;default:return null}return e},inspect:function(){return"["+this.elements.join(", ")+"]"},setElements:function(e){return this.elements=(e.elements||e).slice(),this}},Vector.create=function(e){return(new Vector).setElements(e)},Vector.i=Vector.create([1,0,0]),Vector.j=Vector.create([0,1,0]),Vector.k=Vector.create([0,0,1]),Vector.Random=function(e){var t=[];do{t.push(Math.random())}while(--e);return Vector.create(t)},Vector.Zero=function(e){var t=[];do{t.push(0)}while(--e);return Vector.create(t)},Matrix.prototype={e:function(e,t){return e<1||e>this.elements.length||t<1||t>this.elements[0].length?null:this.elements[e-1][t-1]},row:function(e){return e>this.elements.length?null:Vector.create(this.elements[e-1])},col:function(e){if(e>this.elements[0].length)return null;var t=[],n=this.elements.length,r=n;do{t.push(this.elements[r-n][e-1])}while(--n);return Vector.create(t)},dimensions:function(){return{rows:this.elements.length,cols:this.elements[0].length}},rows:function(){return this.elements.length},cols:function(){return this.elements[0].length},eql:function(e){var t=e.elements||e;if(void 0===t[0][0]&&(t=Matrix.create(t).elements),this.elements.length!=t.length||this.elements[0].length!=t[0].length)return!1;var n,r,i,a=this.elements.length,s=a,o=this.elements[0].length;do{n=s-a,r=o;do{if(i=o-r,Math.abs(this.elements[n][i]-t[n][i])>Sylvester.precision)return!1}while(--r)}while(--a);return!0},dup:function(){return Matrix.create(this.elements)},map:function(e){var t,n,r,i=[],a=this.elements.length,s=a,o=this.elements[0].length;do{n=o,i[t=s-a]=[];do{i[t][r=o-n]=e(this.elements[t][r],t+1,r+1)}while(--n)}while(--a);return Matrix.create(i)},isSameSizeAs:function(e){var t=e.elements||e;return void 0===t[0][0]&&(t=Matrix.create(t).elements),this.elements.length==t.length&&this.elements[0].length==t[0].length},add:function(e){var t=e.elements||e;return void 0===t[0][0]&&(t=Matrix.create(t).elements),this.isSameSizeAs(t)?this.map(function(e,n,r){return e+t[n-1][r-1]}):null},subtract:function(e){var t=e.elements||e;return void 0===t[0][0]&&(t=Matrix.create(t).elements),this.isSameSizeAs(t)?this.map(function(e,n,r){return e-t[n-1][r-1]}):null},canMultiplyFromLeft:function(e){var t=e.elements||e;return void 0===t[0][0]&&(t=Matrix.create(t).elements),this.elements[0].length==t.length},multiply:function(e){if(!e.elements)return this.map(function(t){return t*e});var t=!!e.modulus;if(void 0===(p=e.elements||e)[0][0]&&(p=Matrix.create(p).elements),!this.canMultiplyFromLeft(p))return null;var n,r,i,a,s,o,l=this.elements.length,c=l,h=p[0].length,m=this.elements[0].length,u=[];do{u[n=c-l]=[],r=h;do{i=h-r,a=0,s=m;do{a+=this.elements[n][o=m-s]*p[o][i]}while(--s);u[n][i]=a}while(--r)}while(--l);var p=Matrix.create(u);return t?p.col(1):p},x:function(e){return this.multiply(e)},minor:function(e,t,n,r){var i,a,s,o=[],l=n,c=this.elements.length,h=this.elements[0].length;do{o[i=n-l]=[],a=r;do{o[i][s=r-a]=this.elements[(e+i-1)%c][(t+s-1)%h]}while(--a)}while(--l);return Matrix.create(o)},transpose:function(){var e,t,n,r=this.elements.length,i=this.elements[0].length,a=[],s=i;do{a[e=i-s]=[],t=r;do{a[e][n=r-t]=this.elements[n][e]}while(--t)}while(--s);return Matrix.create(a)},isSquare:function(){return this.elements.length==this.elements[0].length},max:function(){var e,t,n,r=0,i=this.elements.length,a=i,s=this.elements[0].length;do{e=a-i,t=s;do{n=s-t,Math.abs(this.elements[e][n])>Math.abs(r)&&(r=this.elements[e][n])}while(--t)}while(--i);return r},indexOf:function(e){var t,n,r,i=this.elements.length,a=i,s=this.elements[0].length;do{t=a-i,n=s;do{if(this.elements[t][r=s-n]==e)return{i:t+1,j:r+1}}while(--n)}while(--i);return null},diagonal:function(){if(!this.isSquare)return null;var e,t=[],n=this.elements.length,r=n;do{t.push(this.elements[e=r-n][e])}while(--n);return Vector.create(t)},toRightTriangular:function(){var e,t,n,r,i=this.dup(),a=this.elements.length,s=a,o=this.elements[0].length;do{if(0==i.elements[t=s-a][t])for(j=t+1;j<s;j++)if(0!=i.elements[j][t]){e=[],n=o;do{e.push(i.elements[t][r=o-n]+i.elements[j][r])}while(--n);i.elements[t]=e;break}if(0!=i.elements[t][t])for(j=t+1;j<s;j++){var l=i.elements[j][t]/i.elements[t][t];e=[],n=o;do{e.push((r=o-n)<=t?0:i.elements[j][r]-i.elements[t][r]*l)}while(--n);i.elements[j]=e}}while(--a);return i},toUpperTriangular:function(){return this.toRightTriangular()},determinant:function(){if(!this.isSquare())return null;var e,t=this.toRightTriangular(),n=t.elements[0][0],r=t.elements.length-1,i=r;do{n*=t.elements[e=i-r+1][e]}while(--r);return n},det:function(){return this.determinant()},isSingular:function(){return this.isSquare()&&0===this.determinant()},trace:function(){if(!this.isSquare())return null;var e,t=this.elements[0][0],n=this.elements.length-1,r=n;do{t+=this.elements[e=r-n+1][e]}while(--n);return t},tr:function(){return this.trace()},rank:function(){var e,t,n=this.toRightTriangular(),r=0,i=this.elements.length,a=i,s=this.elements[0].length;do{e=a-i,t=s;do{if(Math.abs(n.elements[e][s-t])>Sylvester.precision){r++;break}}while(--t)}while(--i);return r},rk:function(){return this.rank()},augment:function(e){var t=e.elements||e;void 0===t[0][0]&&(t=Matrix.create(t).elements);var n,r,i,a=this.dup(),s=a.elements[0].length,o=a.elements.length,l=o,c=t[0].length;if(o!=t.length)return null;do{n=l-o,r=c;do{a.elements[n][s+(i=c-r)]=t[n][i]}while(--r)}while(--o);return a},inverse:function(){if(!this.isSquare()||this.isSingular())return null;var e,t,n,r,i,a,s,o=this.elements.length,l=o,c=this.augment(Matrix.I(o)).toRightTriangular(),h=c.elements[0].length,m=[];do{i=[],n=h,m[e=o-1]=[],a=c.elements[e][e];do{i.push(s=c.elements[e][r=h-n]/a),r>=l&&m[e].push(s)}while(--n);for(c.elements[e]=i,t=0;t<e;t++){i=[],n=h;do{i.push(c.elements[t][r=h-n]-c.elements[e][r]*c.elements[t][e])}while(--n);c.elements[t]=i}}while(--o);return Matrix.create(m)},inv:function(){return this.inverse()},round:function(){return this.map(function(e){return Math.round(e)})},snapTo:function(e){return this.map(function(t){return Math.abs(t-e)<=Sylvester.precision?e:t})},inspect:function(){var e=[],t=this.elements.length,n=t;do{e.push(Vector.create(this.elements[n-t]).inspect())}while(--t);return e.join("\n")},setElements:function(e){var t,n=e.elements||e;if(void 0!==n[0][0]){var r,i,a,s=n.length,o=s;this.elements=[];do{i=r=n[t=o-s].length,this.elements[t]=[];do{this.elements[t][a=i-r]=n[t][a]}while(--r)}while(--s);return this}var l=n.length,c=l;this.elements=[];do{this.elements.push([n[t=c-l]])}while(--l);return this}},Matrix.create=function(e){return(new Matrix).setElements(e)},Matrix.I=function(e){var t,n,r,i=[],a=e;do{i[t=a-e]=[],n=a;do{i[t][r=a-n]=t==r?1:0}while(--n)}while(--e);return Matrix.create(i)},Matrix.Diagonal=function(e){var t,n=e.length,r=n,i=Matrix.I(n);do{i.elements[t=r-n][t]=e[t]}while(--n);return i},Matrix.Rotation=function(e,t){if(!t)return Matrix.create([[Math.cos(e),-Math.sin(e)],[Math.sin(e),Math.cos(e)]]);var n=t.dup();if(3!=n.elements.length)return null;var r=n.modulus(),i=n.elements[0]/r,a=n.elements[1]/r,s=n.elements[2]/r,o=Math.sin(e),l=Math.cos(e),c=1-l;return Matrix.create([[c*i*i+l,c*i*a-o*s,c*i*s+o*a],[c*i*a+o*s,c*a*a+l,c*a*s-o*i],[c*i*s-o*a,c*a*s+o*i,c*s*s+l]])},Matrix.RotationX=function(e){var t=Math.cos(e),n=Math.sin(e);return Matrix.create([[1,0,0],[0,t,-n],[0,n,t]])},Matrix.RotationY=function(e){var t=Math.cos(e),n=Math.sin(e);return Matrix.create([[t,0,n],[0,1,0],[-n,0,t]])},Matrix.RotationZ=function(e){var t=Math.cos(e),n=Math.sin(e);return Matrix.create([[t,-n,0],[n,t,0],[0,0,1]])},Matrix.Random=function(e,t){return Matrix.Zero(e,t).map(function(){return Math.random()})},Matrix.Zero=function(e,t){var n,r,i=[],a=e;do{i[n=e-a]=[],r=t;do{i[n][t-r]=0}while(--r)}while(--a);return Matrix.create(i)},Line.prototype={eql:function(e){return this.isParallelTo(e)&&this.contains(e.anchor)},dup:function(){return Line.create(this.anchor,this.direction)},translate:function(e){var t=e.elements||e;return Line.create([this.anchor.elements[0]+t[0],this.anchor.elements[1]+t[1],this.anchor.elements[2]+(t[2]||0)],this.direction)},isParallelTo:function(e){if(e.normal)return e.isParallelTo(this);var t=this.direction.angleFrom(e.direction);return Math.abs(t)<=Sylvester.precision||Math.abs(t-Math.PI)<=Sylvester.precision},distanceFrom:function(e){if(e.normal)return e.distanceFrom(this);if(e.direction){if(this.isParallelTo(e))return this.distanceFrom(e.anchor);var t=this.direction.cross(e.direction).toUnitVector().elements,n=this.anchor.elements,r=e.anchor.elements;return Math.abs((n[0]-r[0])*t[0]+(n[1]-r[1])*t[1]+(n[2]-r[2])*t[2])}var i=e.elements||e,a=this.direction.elements,s=i[0]-(n=this.anchor.elements)[0],o=i[1]-n[1],l=(i[2]||0)-n[2],c=Math.sqrt(s*s+o*o+l*l);if(0===c)return 0;var h=(s*a[0]+o*a[1]+l*a[2])/c,m=1-h*h;return Math.abs(c*Math.sqrt(m<0?0:m))},contains:function(e){var t=this.distanceFrom(e);return null!==t&&t<=Sylvester.precision},liesIn:function(e){return e.contains(this)},intersects:function(e){return e.normal?e.intersects(this):!this.isParallelTo(e)&&this.distanceFrom(e)<=Sylvester.precision},intersectionWith:function(e){if(e.normal)return e.intersectionWith(this);if(!this.intersects(e))return null;var t=this.anchor.elements,n=this.direction.elements,r=e.anchor.elements,i=e.direction.elements,a=n[0],s=n[1],o=n[2],l=i[0],c=i[1],h=i[2],m=t[0]-r[0],u=t[1]-r[1],p=t[2]-r[2],f=l*l+c*c+h*h,d=a*l+s*c+o*h,g=((-a*m-s*u-o*p)*f/(a*a+s*s+o*o)+d*(l*m+c*u+h*p))/(f-d*d);return Vector.create([t[0]+g*a,t[1]+g*s,t[2]+g*o])},pointClosestTo:function(e){if(e.direction){if(this.intersects(e))return this.intersectionWith(e);if(this.isParallelTo(e))return null;var t=e.direction.elements,n=t[0],r=t[1],i=t[2],a=Vector.create([(m=(h=(o=this.direction.elements)[2])*n-(l=o[0])*i)*i-(u=l*r-(c=o[1])*n)*r,u*n-(p=c*i-h*r)*i,p*r-m*n]);return(s=Plane.create(e.anchor,a)).intersectionWith(this)}var s;if(this.contains(s=e.elements||e))return Vector.create(s);var o,l,c,h,m,u,p,f=this.anchor.elements,d=f[0],g=f[1],v=f[2],_=Vector.create([(c=(o=this.direction.elements)[1])*(m=(l=o[0])*(s[1]-g)-c*(s[0]-d))-(h=o[2])*(p=h*(s[0]-d)-l*((s[2]||0)-v)),h*(u=c*((s[2]||0)-v)-h*(s[1]-g))-l*m,l*p-c*u]),M=this.distanceFrom(s)/_.modulus();return Vector.create([s[0]+_.elements[0]*M,s[1]+_.elements[1]*M,(s[2]||0)+_.elements[2]*M])},rotate:function(e,t){void 0===t.direction&&(t=Line.create(t.to3D(),Vector.k));var n=Matrix.Rotation(e,t.direction).elements,r=t.pointClosestTo(this.anchor).elements,i=this.anchor.elements,a=this.direction.elements,s=r[0],o=r[1],l=r[2],c=i[0]-s,h=i[1]-o,m=i[2]-l;return Line.create([s+n[0][0]*c+n[0][1]*h+n[0][2]*m,o+n[1][0]*c+n[1][1]*h+n[1][2]*m,l+n[2][0]*c+n[2][1]*h+n[2][2]*m],[n[0][0]*a[0]+n[0][1]*a[1]+n[0][2]*a[2],n[1][0]*a[0]+n[1][1]*a[1]+n[1][2]*a[2],n[2][0]*a[0]+n[2][1]*a[1]+n[2][2]*a[2]])},reflectionIn:function(e){if(e.normal){var t=this.anchor.elements,n=this.direction.elements,r=t[0],i=t[1],a=t[2],s=n[0],o=n[1],l=n[2],c=this.anchor.reflectionIn(e).elements,h=r+s,m=i+o,u=a+l,p=e.pointClosestTo([h,m,u]).elements;return Line.create(c,[p[0]+(p[0]-h)-c[0],p[1]+(p[1]-m)-c[1],p[2]+(p[2]-u)-c[2]])}if(e.direction)return this.rotate(Math.PI,e);var f=e.elements||e;return Line.create(this.anchor.reflectionIn([f[0],f[1],f[2]||0]),this.direction)},setVectors:function(e,t){if(e=Vector.create(e),t=Vector.create(t),2==e.elements.length&&e.elements.push(0),2==t.elements.length&&t.elements.push(0),e.elements.length>3||t.elements.length>3)return null;var n=t.modulus();return 0===n?null:(this.anchor=e,this.direction=Vector.create([t.elements[0]/n,t.elements[1]/n,t.elements[2]/n]),this)}},Line.create=function(e,t){return(new Line).setVectors(e,t)},Line.X=Line.create(Vector.Zero(3),Vector.i),Line.Y=Line.create(Vector.Zero(3),Vector.j),Line.Z=Line.create(Vector.Zero(3),Vector.k),Plane.prototype={eql:function(e){return this.contains(e.anchor)&&this.isParallelTo(e)},dup:function(){return Plane.create(this.anchor,this.normal)},translate:function(e){var t=e.elements||e;return Plane.create([this.anchor.elements[0]+t[0],this.anchor.elements[1]+t[1],this.anchor.elements[2]+(t[2]||0)],this.normal)},isParallelTo:function(e){var t;return e.normal?(t=this.normal.angleFrom(e.normal),Math.abs(t)<=Sylvester.precision||Math.abs(Math.PI-t)<=Sylvester.precision):e.direction?this.normal.isPerpendicularTo(e.direction):null},isPerpendicularTo:function(e){var t=this.normal.angleFrom(e.normal);return Math.abs(Math.PI/2-t)<=Sylvester.precision},distanceFrom:function(e){if(this.intersects(e)||this.contains(e))return 0;if(e.anchor){var t=this.anchor.elements,n=e.anchor.elements,r=this.normal.elements;return Math.abs((t[0]-n[0])*r[0]+(t[1]-n[1])*r[1]+(t[2]-n[2])*r[2])}var i=e.elements||e;return t=this.anchor.elements,r=this.normal.elements,Math.abs((t[0]-i[0])*r[0]+(t[1]-i[1])*r[1]+(t[2]-(i[2]||0))*r[2])},contains:function(e){if(e.normal)return null;if(e.direction)return this.contains(e.anchor)&&this.contains(e.anchor.add(e.direction));var t=e.elements||e,n=this.anchor.elements,r=this.normal.elements;return Math.abs(r[0]*(n[0]-t[0])+r[1]*(n[1]-t[1])+r[2]*(n[2]-(t[2]||0)))<=Sylvester.precision},intersects:function(e){return void 0===e.direction&&void 0===e.normal?null:!this.isParallelTo(e)},intersectionWith:function(e){if(!this.intersects(e))return null;if(e.direction){var t=e.direction.elements,n=this.anchor.elements,r=((a=this.normal.elements)[0]*(n[0]-(s=e.anchor.elements)[0])+a[1]*(n[1]-s[1])+a[2]*(n[2]-s[2]))/(a[0]*t[0]+a[1]*t[1]+a[2]*t[2]);return Vector.create([s[0]+t[0]*r,s[1]+t[1]*r,s[2]+t[2]*r])}if(e.normal){for(var i=this.normal.cross(e.normal).toUnitVector(),a=this.normal.elements,s=this.anchor.elements,o=e.normal.elements,l=e.anchor.elements,c=Matrix.Zero(2,2),h=0;c.isSingular();)h++,c=Matrix.create([[a[h%3],a[(h+1)%3]],[o[h%3],o[(h+1)%3]]]);for(var m=c.inverse().elements,u=a[0]*s[0]+a[1]*s[1]+a[2]*s[2],p=o[0]*l[0]+o[1]*l[1]+o[2]*l[2],f=[m[0][0]*u+m[0][1]*p,m[1][0]*u+m[1][1]*p],d=[],g=1;g<=3;g++)d.push(h==g?0:f[(g+(5-h)%3)%3]);return Line.create(d,i)}},pointClosestTo:function(e){var t=e.elements||e,n=this.anchor.elements,r=this.normal.elements,i=(n[0]-t[0])*r[0]+(n[1]-t[1])*r[1]+(n[2]-(t[2]||0))*r[2];return Vector.create([t[0]+r[0]*i,t[1]+r[1]*i,(t[2]||0)+r[2]*i])},rotate:function(e,t){var n=Matrix.Rotation(e,t.direction).elements,r=t.pointClosestTo(this.anchor).elements,i=this.anchor.elements,a=this.normal.elements,s=r[0],o=r[1],l=r[2],c=i[0]-s,h=i[1]-o,m=i[2]-l;return Plane.create([s+n[0][0]*c+n[0][1]*h+n[0][2]*m,o+n[1][0]*c+n[1][1]*h+n[1][2]*m,l+n[2][0]*c+n[2][1]*h+n[2][2]*m],[n[0][0]*a[0]+n[0][1]*a[1]+n[0][2]*a[2],n[1][0]*a[0]+n[1][1]*a[1]+n[1][2]*a[2],n[2][0]*a[0]+n[2][1]*a[1]+n[2][2]*a[2]])},reflectionIn:function(e){if(e.normal){var t=this.anchor.elements,n=this.normal.elements,r=t[0],i=t[1],a=t[2],s=n[0],o=n[1],l=n[2],c=this.anchor.reflectionIn(e).elements,h=r+s,m=i+o,u=a+l,p=e.pointClosestTo([h,m,u]).elements;return Plane.create(c,[p[0]+(p[0]-h)-c[0],p[1]+(p[1]-m)-c[1],p[2]+(p[2]-u)-c[2]])}if(e.direction)return this.rotate(Math.PI,e);var f=e.elements||e;return Plane.create(this.anchor.reflectionIn([f[0],f[1],f[2]||0]),this.normal)},setVectors:function(e,t,n){if(null===(e=(e=Vector.create(e)).to3D()))return null;if(null===(t=(t=Vector.create(t)).to3D()))return null;if(void 0===n)n=null;else if(null===(n=(n=Vector.create(n)).to3D()))return null;var r,i,a=e.elements[0],s=e.elements[1],o=e.elements[2],l=t.elements[0],c=t.elements[1],h=t.elements[2];if(null!==n){var m=n.elements[0],u=n.elements[1],p=n.elements[2];if(0===(i=(r=Vector.create([(c-s)*(p-o)-(h-o)*(u-s),(h-o)*(m-a)-(l-a)*(p-o),(l-a)*(u-s)-(c-s)*(m-a)])).modulus()))return null;r=Vector.create([r.elements[0]/i,r.elements[1]/i,r.elements[2]/i])}else{if(0===(i=Math.sqrt(l*l+c*c+h*h)))return null;r=Vector.create([t.elements[0]/i,t.elements[1]/i,t.elements[2]/i])}return this.anchor=e,this.normal=r,this}},Plane.create=function(e,t,n){return(new Plane).setVectors(e,t,n)},Plane.XY=Plane.create(Vector.Zero(3),Vector.k),Plane.YZ=Plane.create(Vector.Zero(3),Vector.i),Plane.ZX=Plane.create(Vector.Zero(3),Vector.j),Plane.YX=Plane.XY,Plane.ZY=Plane.YZ,Plane.XZ=Plane.ZX;var $V=Vector.create,$M=Matrix.create,$L=Line.create,$P=Plane.create;function addWheelHandler(e,t){e.addEventListener?"onwheel"in document?e.addEventListener("wheel",t,!1):"onmousewheel"in document?e.addEventListener("mousewheel",t,!1):e.addEventListener("MozMousePixelScroll",t,!1):e.attachEvent("onmousewheel",t)}function clampMapPan(){var e=document.getElementById("map-canvas");map_pan[0]=clamp(map_pan[0],-(map_scale-1)*e.width,0),map_pan[1]=clamp(map_pan[1],-(map_scale-1)*e.height,0)}function mapOnWheel(e){var t=(e=e||window.event).wheelDelta?e.wheelDelta:-40*(e.deltaY||e.detail);t*=.8*map_scale;var n=null!=e.offsetX?e.offsetX:e.pageX-$("#map-canvas").offset().left,r=null!=e.offsetY?e.offsetY:e.pageY-$("#map-canvas").offset().top;map_scale_new=clamp(map_scale+.001*t,1,15),map_pan[0]=n-(n-map_pan[0])*map_scale_new/map_scale,map_pan[1]=r-(r-map_pan[1])*map_scale_new/map_scale,map_scale=map_scale_new,clampMapPan(),redraw_map(0),e.preventDefault?e.preventDefault():e.returnValue=!1}function on_touch_event(e){if(e.gesture){if("dragstart"==e.type)isDraggingMap=!0;else if("transformstart"==e.type)isTransformingMap=!0;else if("dragend"==e.type)isDraggingMap=!1;else if("transformend"==e.type)isTransformingMap=!1;else{if("drag"!=e.type&&"transform"!=e.type)return console.log("Unexpected event type"),void console.log(e);if("transform"==e.type){scale0=map_scale,map_scale=clamp(map_scale*e.gesture.scale/prevScale,1,3);var t=e.gesture.center.pageX-$("#map-canvas").offset().left,n=e.gesture.center.pageY-$("#map-canvas").offset().top;map_pan[0]=t-(t-map_pan[0])*map_scale/scale0,map_pan[1]=n-(n-map_pan[1])*map_scale/scale0}map_pan[0]+=e.gesture.center.pageX-prevMousePos[0],map_pan[1]+=e.gesture.center.pageY-prevMousePos[1],clampMapPan(),redraw_map(0)}prevMousePos=[e.gesture.center.pageX,e.gesture.center.pageY],prevScale=e.gesture.scale}}function calcMapObjectColor(e){if("blink"in e&&e.blink){var t=2==e.blink?blinkHeavyVal:blinkNormalVal,n=e["color[]"],r=[255,255,0];return rgb_to_hex(Math.floor(lerp(n[0],r[0],t)),Math.floor(lerp(n[1],r[1],t)),Math.floor(lerp(n[2],r[2],t)))}return e.color}function drawMapGrid(e){if(map_info&&"map_min"in map_info){var t=e.getContext("2d"),n=e.width,r=e.height,i=map_info.map_min,a=map_info.map_max,s=n/(a[0]-i[0]),o=r/(a[1]-i[1]);t.lineWidth=1,t.strokeStyle="#555",t.beginPath();for(var l=i[1];l<=a[1];l+=map_info.grid_steps[1]){var c=Math.floor((l-i[1])*o)+.5;t.moveTo(0,c),t.lineTo(n,c)}for(var h=i[0];h<=a[0];h+=map_info.grid_steps[0]){var m=Math.floor((h-i[0])*s)+.5;t.moveTo(m,0),t.lineTo(m,r)}t.stroke(),t.fillStyle="#111",t.font="normal 9pt sans-serif",t.textBaseline="middle",t.textAlign="left",l=i[1]+.5*map_info.grid_steps[1];for(var u=0;l<=a[1]&&u<26;l+=map_info.grid_steps[1],++u)c=Math.floor((l-i[1])*o)+.5,t.fillText(String.fromCharCode(65+u),3,c);for(t.textBaseline="top",t.textAlign="center",h=i[0]+.5*map_info.grid_steps[0],u=1;h<=a[0];h+=map_info.grid_steps[0],++u)m=Math.floor((h-i[0])*s)+.5,t.fillText(u,m,3)}}function drawMapGridScaled(e){if(map_info&&"map_min"in map_info){var t=e.getContext("2d"),n=e.width,r=e.height,i=map_info.map_min,a=map_info.map_max,s=map_info.grid_steps,o=n*map_scale/(a[0]-i[0]),l=r*map_scale/(a[1]-i[1]),c=Math.floor(-map_pan[0]/o/s[0]),h=Math.floor(-map_pan[1]/l/s[1]),m=i[0]+c*s[0],u=i[1]+h*s[1],p=i[0]+Math.ceil((n-map_pan[0])/o/s[0])*s[0],f=i[1]+Math.ceil((r-map_pan[1])/l/s[1])*s[1];t.lineWidth=1,t.strokeStyle="#555",t.beginPath();for(var d=u;d<=f;d+=s[1]){var g=Math.floor((d-i[1])*l+map_pan[1])+.5;t.moveTo(0,g),t.lineTo(n,g)}for(var v=m;v<=p;v+=s[0]){var _=Math.floor((v-i[0])*o+map_pan[0])+.5;t.moveTo(_,0),t.lineTo(_,r)}t.stroke(),t.fillStyle="#111",t.font="normal 9pt sans-serif",t.textBaseline="middle",t.textAlign="left",d=u+.5*map_info.grid_steps[1];for(var M=h;d<=f&&M<26;d+=s[1],++M)g=Math.floor((d-i[1])*l+map_pan[1])+.5,t.fillText(String.fromCharCode(65+M),3,g);for(t.textBaseline="top",t.textAlign="center",v=m+.5*map_info.grid_steps[0],M=c;v<=p;v+=s[0],++M)_=Math.floor((v-i[0])*o+map_pan[0])+.5,t.fillText(M+1,_,3)}}function draw_airfield(e,t,n){var r=e.width*n.sx*map_scale+map_pan[0],i=e.height*n.sy*map_scale+map_pan[1],a=e.width*n.ex*map_scale+map_pan[0],s=e.height*n.ey*map_scale+map_pan[1];t.lineWidth=3*Math.sqrt(map_scale),t.strokeStyle=calcMapObjectColor(n),t.beginPath(),t.moveTo(r,i),t.lineTo(a,s),t.stroke()}function draw_player(e,t,n,r){var i=n.x,a=n.y,s=$V([n.dx,n.dy]);if(lastPlayerPos){var o=lastPlayerPos.x,l=lastPlayerPos.y;Math.abs(o-i)<.01&&(i=approach(o,i,r,.4)),Math.abs(l-a)<.01&&(a=approach(l,a,r,.4));var c=$V(lastPlayerPos.dir),h=s.signedAngle2DFrom(c);h>.25*-Math.PI&&h<.25*Math.PI&&(h=approach(0,h,r,.4),s=c.rotate(h,[0,0]))}t.fillStyle="#fff",t.lineWidth=2,t.strokeStyle="#333",t.beginPath();var m=s.at(0),u=s.at(1),p=i*e.width*map_scale+map_pan[0],f=a*e.height*map_scale+map_pan[1];return t.moveTo((p-=5*m)-4*u,(f-=5*u)+4*m),t.lineTo(p+4*u,f-4*m),t.lineTo(p+10*m,f+10*u),t.closePath(),t.fill(),t.stroke(),{x:i,y:a,dir:s.elements}}function draw_map_object(e,t,n,r){var i=e.width*n.x,a=e.height*n.y;t.fillStyle=calcMapObjectColor(n),t.lineWidth=1,t.strokeStyle="#000",t.font="bold 18pt Icons",t.textBaseline="middle",t.textAlign="center";var s,o=i*map_scale+map_pan[0],l=a*map_scale+map_pan[1];if(s="Airdefence"==n.icon?"4":"Structure"==n.icon?"5":"waypoint"==n.icon?"6":"capture_zone"==n.icon?"7":"bombing_point"==n.icon?"8":"defending_point"==n.icon?"9":"respawn_base_tank"==n.icon?"0":"respawn_base_fighter"==n.icon?".":"respawn_base_bomber"==n.icon?":":n.icon[0],r){t.save(),t.translate(o,l);var c=Math.atan2(n.dx,-n.dy);t.rotate(c),t.translate(-o,-l),t.fillText(s,o,l),t.strokeText(s,o,l),t.restore()}else t.fillText(s,o,l),t.strokeText(s,o,l)}function redraw_map(e){var t=document.getElementById("map-canvas"),n=t.getContext("2d");n.clearRect(0,0,t.width,t.height),n.setTransform(map_scale,0,0,map_scale,map_pan[0],map_pan[1]),map_image.complete&&map_image.naturalWidth&&n.drawImage(map_image,0,0,t.width,t.height),n.setTransform(1,0,0,1,0,0),drawMapGridScaled(t);var r=null;if($.isArray(map_objects))for(var i=0;i<map_objects.length;++i){var a=map_objects[i];"airfield"==a.type?draw_airfield(t,n,a):"Player"==a.icon?r=a:draw_map_object(t,n,a,"respawn_base_fighter"==a.type||"respawn_base_bomber"==a.type)}lastPlayerPos=r?draw_player(t,n,r,e):null}function update_timers(){var e=(new Date).getTime(),t=0;return lastT&&(t=.001*(e-lastT),blinkNormalT+=t,blinkHeavyT+=t,blinkNormalT>2&&(blinkNormalT-=2*Math.floor(blinkNormalT/2)),blinkHeavyT>1.2&&(blinkHeavyT-=1.2*Math.floor(blinkHeavyT/1.2)),blinkNormalVal=Math.exp(-Math.pow(5*blinkNormalT-2,4)),blinkHeavyVal=Math.exp(-Math.pow(5*blinkHeavyT-2,4))),lastT=e,t}function update_object_positions(e){map_objects=e,redraw_map(update_timers())}function update_map_info(e){var t=map_info&&"map_generation"in map_info?map_info.map_generation:-1,n=e&&"map_generation"in e?e.map_generation:-1;if(map_info=e,t!=n){const e=localStorage.getItem("endpoint")||"http://localhost:8111";map_image.src=e+"/map.img?gen="+n,map_scale=1,map_pan=[0,0],redraw_map(0)}}function updateSlow(){const e=localStorage.getItem("endpoint")||"http://localhost:8111";$.ajax({type:"GET",url:e+"/map_obj.json",success:update_object_positions}),$.ajax({type:"GET",url:e+"/map_info.json",success:update_map_info})}function updateFast(){var e=update_timers();isDraggingMap||isTransformingMap||redraw_map(e)}function lerp(e,t,n){return e*(1-n)+t*n}function clamp(e,t,n){return Math.max(t,Math.min(e,n))}function approach(e,t,n,r){return r<1e-9?t:e+(1-Math.exp(-n/r))*(t-e)}function rgb_to_hex(e,t,n){var r=e.toString(16),i=t.toString(16),a=n.toString(16);return"#"+(1==r.length?"0"+r:r)+(1==i.length?"0"+i:i)+(1==a.length?"0"+a:a)}function get_pos_prop(e,t){return"width"==t||"height"==t?e[t]():e.offset()[t]}function set_pos_prop(e,t,n){if("width"==t||"height"==t)return e[t](n);var r=e.offset();r[t]=n,e.offset(r)}function load_positions(){for(var e in pos_save_elem_ids){var t=Cookies.get(e);if(t){var n=$(e),r=t.split("|");for(var i in r){var a=r[i].split(":");2==a.length&&set_pos_prop(n,a[0],a[1])}}}var s=$("#map-canvas");s.get(0).width=s.width(),s.get(0).height=s.height()}function save_positions(){for(var e in pos_save_elem_ids){var t=$(e),n=pos_save_elem_ids[e],r="";for(var i in n)r&&(r+="|"),r+=n[i]+":"+get_pos_prop(t,n[i]);r&&Cookies.set(e,r,{expires:cookieLifeTime})}}function init(){var e=document.getElementById("map-canvas");addWheelHandler(e,mapOnWheel),e.onselectstart=function(){return!1};var t=Hammer(e,hammer_opt),n=["drag","dragstart","dragend","transform","transformstart","transformend"];for(var r in n)t.on(n[r],on_touch_event);load_positions(),"file:"!=document.location.protocol&&(setInterval(updateSlow,500),setInterval(updateFast,25))}map_objects=null,map_info=null,map_image=new Image,cookieLifeTime=864e5,map_scale=1,map_pan=[0,0],prevMousePos=null,prevScale=null,lastT=null,blinkNormalT=0,blinkHeavyT=0,blinkNormalVal=0,blinkHeavyVal=0,lastPlayerPos=null,isDraggingMap=!1,isTransformingMap=!1,hammer_opt={hold:!1,tap:!1,doubletap:!1,drag:!0,dragstart:!0,dragend:!0,dragup:!1,dragdown:!1,dragleft:!1,dragright:!1,swipe:!1,swipeup:!1,swipedown:!1,swipeleft:!1,swiperight:!1,transform:!0,transformstart:!0,transformend:!0,rotate:!1,pinch:!1,pinchin:!1,pinchout:!1,prevent_default:!0,no_mouseevents:!0},Array.indexOf||(Array.prototype.indexOf=function(e){for(var t=0;t<this.length;t++)if(this[t]==e)return t;return-1}),pos_save_elem_ids={"#map-root":["left","top"],"#map-canvas":["width","height"]},window.onload=init,$(document).ready(function(){});